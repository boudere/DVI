import{initializeApp as U}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";import{getAuth as J,GoogleAuthProvider as B,signInWithPopup as F}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";import{getFirestore as V,setDoc as C,doc as E,serverTimestamp as Y,getDoc as I,updateDoc as z}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();const m="DATA_INFO",g="PANTALLA_MANAGER",p="SCENE_MANAGER",f="DIALOGO_MANAGER",_="MINIJUEGO_MANAGER",b="CURSOR_MANAGER",S="LOGIN_SCENE",D="JuegoOveja",w="JuegoDiscoteca",G="SIGNAL_SCENE_CREATED";class v extends Phaser.Scene{constructor(t){super(t),this.isPause=!1,this.animations_finished=0,this.total_animations=0}exit(){this.pause()}enter(t){return!!t}_update(){this.isPause}pause(){this.isPause=!0}unpause(){this.isPause=!1}sendSignal(t){}onSignal(t){}scene_created(){this.scene.get(p).events.emit(G,this.scene.key)}starting_animation(){}cursor_entered(t,s){this.scene.get(p).cursor_entered(t,s)}cursor_exited(t){this.scene.get(p).cursor_exited(t)}move(t,s,e){}}class P extends Phaser.GameObjects.Sprite{constructor(t,s,e,i,a,o,n){super(t,s,e,i),this._reset_varaibles(),this.setScale(a,o),n&&(this._set_events(),this.on_click=n),this._set_main_events(),this.on("destroy",this.before_destroy,this)}_reset_varaibles(){this.isPause=!1,this.mouse_over=!1,this.game_object_data={}}_add_sprite(t){this.scene.add.existing(this),t?this.start_animation(t):this.finish_animation()}async start_animation(t){this.scene.starting_animation();let s=this.animation.get_animation_data(t,this.game_object_data);for(const[e,i]of Object.entries(s)){const a=i.map(o=>this.run_tween(o));await Promise.all(a)}this.finish_animation()}run_tween(t){"alpha_start"in t&&(this.alpha=t.alpha_start),"scaleX_start"in t&&(this.scale=t.scaleX_start),"scaleY_start"in t&&(this.scale=t.scaleY_start),"pos_x_start"in t&&(this.x=t.pos_x_start),"pos_y_start"in t&&(this.y=t.pos_y_start);const s={};return"alpha_end"in t&&(s.alpha=t.alpha_end),"scaleX_end"in t&&(s.scale=t.scaleX_end),"scaleY_end"in t&&(s.scale=t.scaleY_end),"pos_x_end"in t&&(s.x=t.pos_x_end),"pos_y_end"in t&&(s.y=t.pos_y_end),new Promise(e=>{this.scene.tweens.add({targets:this,duration:t.duration||500,ease:t.ease||"Power2",...s,onComplete:()=>e()})})}finish_animation(){}exit(){this.visible=!1,this._remove_events()}enter(){this.visible=!0}_update(){return!this.isPause}pause(){this.mouse_over&&this._mouse_out(),this.disableInteractive()}unpause(){this.setInteractive()}_start_animation(){}_stop_animation(){}_set_events(){this.on("pointerdown",this._mouse_down,this),this.on("pointerup",this._mouse_up,this),this.on("pointermove",this._mouse_move,this)}_remove_events(){this._remove_main_events(),this.off("pointerdown",this._mouse_down,this),this.off("pointerup",this._mouse_up,this),this.off("pointermove",this._mouse_move,this)}_set_main_events(){this.on("pointerover",this._mouse_over,this),this.on("pointerout",this._mouse_out,this),this.on("pointerupoutside",this._mouse_out,this)}_remove_main_events(){this.off("pointerover",this._mouse_over,this),this.off("pointerout",this._mouse_out,this),this.off("pointerupoutside",this._mouse_out,this)}_mouse_enter(){return!this.isPause}_mouse_over(){let t=!1;return this.on_click&&(t=!0),this.nombre&&this.scene.cursor_entered(this.nombre,t),!t||this.isPause?!1:(this.mouse_over=!0,this.setTint(14477567),!0)}_mouse_out(){return this.isPause?!1:(this.mouse_over=!1,this.clearTint(),this.nombre&&this.scene.cursor_exited(this.nombre),!0)}_mouse_down(){return!this.isPause}_mouse_up(){return!this.isPause}_mouse_move(){return!this.isPause}before_destroy(){}}class j extends P{constructor(t,s,e,i,a){super(t,s,e,i,1,1),this.delauy=a}_reset_varaibles(){super._reset_varaibles()}finish_animation(){}exit(){this.musica.stop(),super.exit()}enter(){super.enter(),setTimeout(()=>{this._add_sprite(this.animation_data)},this.delay)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}_start_animation(){super._start_animation()}_stop_animation(){super._stop_animation()}_set_events(){super._set_events()}_remove_events(){super._remove_events()}_mouse_enter(){super._mouse_enter()}_mouse_over(){super._mouse_over()}_mouse_out(){super._mouse_out()}_mouse_down(){super._mouse_down()}_mouse_up(){super._mouse_up(),this.scene.signal_click(this.on_click)}_mouse_move(){super._mouse_move()}before_destroy(){super.before_destroy()}}class W extends Phaser.GameObjects.Text{constructor(t,s,e,i,a,o,n,h={}){let l={...{fontSize:"32px",fontFamily:"Arial",color:"#000000",align:"left",lineSpacing:10,wordWrap:{width:a-20}},...h};super(t,s,e,"",l),this._reset_varaibles(),this.texto=o,this.containter=i,this.setOrigin(0,0),this.setDepth(i.depth+1),this.on("destroy",this.before_destroy,this),setTimeout(()=>{this._add_text(!0)},n)}_reset_varaibles(){this.isPause=!1}_add_text(t){this.scene.add.existing(this),t?this.start_animation():this.finish_animation()}start_animation(){let t=0,s=this.texto,e="";this.setText(""),this.scene.time.addEvent({delay:30,callback:()=>{e+=s.charAt(t),this.setText(e),t++,t>=s.length&&this.containter.finish_animation()},repeat:s.length-1})}run_tween(t){}finish_animation(){}exit(){this.visible=!1}enter(){this.visible=!0}_update(){return!this.isPause}pause(){this.mouse_over&&this._mouse_out(),this.disableInteractive()}unpause(){this.setInteractive()}_start_animation(){this.scene.start_animation()}_stop_animation(){}_set_events(){}before_destroy(){}}class T extends W{constructor(t,s,e,i,a,o,n,h={}){super(t,s,e,i,a,o,n,h)}}class O{constructor(t){this.animation={},this.DURATION="duration",this.data_json=t.scene.get(m).get_data_json().Json,this.animation_data=t.scene.get(m).get_json(this.data_json.Animation)}get_animation_data(t,s){let e={};return Object.entries(s).forEach(([i,a])=>{e[i]=a}),Object.entries(t).forEach(([i,a])=>{this.animation[i]=[],Object.entries(e).forEach(([o,n])=>{s[o]=e[o]}),a.forEach(o=>{this.animation[i].push({});let n=this.animation[i].length-1;this.get_animation(e,t,i,n,s)})}),this.animation}get_animation(t,s,e,i,a){let o=this.animation_data[s[e][i].type];this.animation[e][i][this.DURATION]=s[e][i][this.DURATION],Object.entries(o).forEach(([n,h])=>{let c=this.translate_animation(h,e,i,s,a);this.animation[e][i][n]=c,this.animation[e][i][n]=c,n.endsWith("_end")&&(t[n.slice(0,-4)]=c)})}translate_animation(t,s,e,i,a){if(typeof t!="string")return t;const o=[];let n="",h=0,c="";for(;h<t.length;){let d=t[h];if(/\d/.test(d)){const{result:u,nextIndex:x}=this.readWhile(t,h,/\d/);o.push(parseInt(u)),h=x;continue}if(d==="{"){const{result:u,nextIndex:x}=this.readBetween(t,h+1,"}");c=u,h=x;continue}if(d==="["){const{result:u,nextIndex:x}=this.readBetween(t,h+1,"]");o.push({bracketsContent:u}),h=x;continue}if(d==="$"){const{result:u,nextIndex:x}=this.readWhile(t,h+1,/[^\s\{\}\[\]\$]/);o.push({variable:u}),h=x;continue}h++}n.trim()&&o.push(n.trim());let l=[];return o.forEach(d=>{if(Number.isInteger(d))l.push(d);else if(d.variable){let u=d.variable.split("_");u.pop(),u=u.join("_"),l.push(a[u])}else d.bracketsContent&&l.push(i[s][e].var[d.bracketsContent])}),l.length<2?l[0]:this.operation_animation(l[0],l[1],c)}readBetween(t,s,e){let i="",a=s;for(;a<t.length&&t[a]!==e;)i+=t[a],a++;return{result:i,nextIndex:a+1}}readWhile(t,s,e){let i="",a=s;for(;a<t.length&&e.test(t[a]);)i+=t[a],a++;return{result:i,nextIndex:a}}operation_animation(t,s,e){switch(e){case"add":return t+s;case"sub":return t-s;case"mul":return t*s;case"div":return t/s;default:console.log("No se ha encontrado la operacion: "+e);break}}}class X extends j{constructor(t,s,e,i,a,o){super(t,s,e,i,200),this.SCALE=1.2,this.text=a,this.finished_animation=0,this.total_animations=0,this.game_object_data={alpha:this.alpha,scale:this.scale,pos_x:this.x,pos_y:this.y},o?(this.animation_data={animation_1:[{type:"fade_in",duration:400},{type:"scale_center",duration:400,var:{scale:this.SCALE}}]},this.animation=new O(this.scene,this.animation_data,1e3)):this.setScale(SCALE)}create(){this.on("destroy",this.before_destroy,this)}finish_animation(){if(this.total_animations==0){this._load_main_text();return}this.finished_animation++,this.finished_animation==this.total_animations&&this.scene.finish_animation()}setText(t){this.total_animations=0,this.finished_animation=0,this.text=t,this._load_main_text()}_load_main_text(){this.main_text&&this.main_text.destroy();let t=this.x-this.width/2-100,s=this.y-this.height/2;this.main_text=new T(this.scene,t,s,this,this.width*1.2,this.text,this.delay).setOrigin(0,0),this.total_animations++}before_destroy(){this.main_text&&this.main_text.destroy(),super.before_destroy()}}class K extends j{constructor(t,s,e,i,a,o,n){super(t,s,e,i,200),this.setOrigin(1,1),this.SCALE=1.2,this.text=a,this.next_text=o,this.finished_animation=0,this.total_animations=0,this.game_object_data={alpha:this.alpha,scale:this.scale,pos_x:this.x,pos_y:this.y},n?(this.animation_data={animation_1:[{type:"fade_in",duration:200},{type:"scale_up",duration:200,var:{scaleX:this.SCALE,scaleY:this.SCALE}}]},this.animation=new O(this.scene,this.animation_data,1e3)):this.setScale(this.SCALE)}finish_animation(){if(this.total_animations==0){this._load_main_text();return}this.finished_animation++,this.finished_animation==this.total_animations&&(this.finished_animation=0,this.scene.finish_animation())}setText(t){this.total_animations=0,this.finished_animation=0,this.text=t,this._load_main_text()}_load_main_text(){this.main_text&&this.main_text.destroy();let t=this.x-this.width/2-100,s=this.y-this.height/2;this.main_text=new T(this.scene,t-this.width/2,s-this.height/3,this,this.width*this.SCALE,this.text,this.delay,{fontSize:"32px"}).setOrigin(0,0),this.total_animations++}before_destroy(){super.before_destroy(),this.main_text&&this.main_text.destroy()}pause(){super.pause(),this._remove_events()}unpause(){super.unpause(),this._set_events()}_mouse_up(){this.on_click={scene:"dialogo",name:this.next_text},super._mouse_up()}}class $ extends j{constructor(t,s,e,i,a){super(t,s,e,i,a),this.finished_animation=0,this.total_animations=0,this.game_object_data={alpha:this.alpha,scaleX:this.scaleX,scaleY:this.scaleY,pos_x:this.x,pos_y:this.y},this.animation_data={animation_1:[{type:"fade_in",duration:400},{type:"move_right",duration:400,var:{pos_x:500}}]},this.animation=new O(this.scene,this.animation_data,1e3),this.total_animations++}finish_animation(){this.finished_animation++,this.finished_animation==this.total_animations&&(this.finished_animation=0,this.scene.finish_animation())}}class q extends v{constructor(){super({key:f}),this.CUADRADO_DIALOGO="cuadrado_dialogo",this.BUTTON_CUADRADO_DIALOGO="boton_dialogo",this.BACKGROUND_DEPTH=0,this.PERSONAJE_DEPTH=1,this.CUADRADO_DIALOGO_DEPTH=3,this.PISO_MUSICA="tema_inicial",this.MUSIC_VOLUME=.1,this.MUSIC_LOOP=!0}_reset_data(){this.cuadrado_dialogo=null,this.main_text=null,this.dialogo_data_selected=null,this.npc="",this.buttons_index=0,this.buttons=[]}create(){this.data_info_scene=this.scene.get(m),this.dialogo_data=this.data_info_scene.get_json(this.data_info_scene.data_json.Dialogos),this.musica=this.sound.add(this.data_info_scene.get_musica(this.PISO_MUSICA),{loop:this.MUSIC_LOOP,volume:this.MUSIC_VOLUME}),this.scene_created()}_load_dialogo(t){const{width:s,height:e}=this.sys.game.canvas;this.animation_finished=!1,this.animate?this._load_cuadrado_dialogo(s,e):this._set_main_text(),this.total_animations++,this._load_background(),this.animate&&(this._load_personaje(s,e),this.total_animations++),this.buttons&&this.buttons.forEach(i=>i.destroy()),this.dialogo_data_selected.opciones&&this._load_buttons(s,e)}exit(){super.exit(),this.cuadrado_dialogo&&(this.cuadrado_dialogo.visible=!1,this.cuadrado_dialogo.main_text.visible=!1),this.persoanje&&(this.persoanje.visible=!1),this.background&&(this.background.visible=!1),this.musica.stop(),this._remove_events()}enter(t){super.enter(t)&&(this.musica.isPlaying||this.musica.play(),this.dialogo_data_selected=this.dialogo_data[t],this.animate=this.dialogo_data_selected.npc!=this.npc,this.npc=this.dialogo_data_selected.npc,this.total_animations=0,this.finished_animation=0,this.buttons_index=0,this._load_dialogo(t),this.background.visible=!0,this.animate&&this.persoanje&&this.persoanje.enter(),this._set_events(),this.pause())}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}starting_animation(){this.animation_finished=!1,this.pause()}finish_animation(){if(this.finished_animation++,this.finished_animation==1&&this.animate){this.cuadrado_dialogo.enter();return}if(this.dialogo_data_selected.opciones&&this.buttons_index<this.buttons.length){this.buttons[this.buttons_index].enter(),this.buttons_index++;return}this.finished_animation==this.total_animations&&(this.animation_finished=!0,this.dialogo_data_selected.opciones&&this.buttons.forEach(t=>t.unpause()),this.unpause())}signal_click(t){t.scene=="dialogo"?this.enter(t.name):this.scene.get(p).signal_click(t)}_load_background(){this.background&&this.background.destroy();let t=this.data_info_scene.get_img(f,this.dialogo_data_selected.fondo);this.background=this.add.image(0,0,t).setOrigin(0,0),this.background.setDepth(this.BACKGROUND_DEPTH)}_load_cuadrado_dialogo(t,s){this.cuadrado_dialogo&&this.cuadrado_dialogo.destroy();let e=this.data_info_scene.get_img(f,this.CUADRADO_DIALOGO);this.cuadrado_dialogo=new X(this,t/2,s-150,e,this.dialogo_data_selected.texto,!0),this.cuadrado_dialogo.setDepth(this.CUADRADO_DIALOGO_DEPTH)}_set_main_text(){this.cuadrado_dialogo.setText(this.dialogo_data_selected.texto)}_load_personaje(t,s){this.persoanje&&this.persoanje.destroy();let e=this.dialogo_data_selected.npc+"_"+this.dialogo_data_selected.pose,i=this.data_info_scene.get_img(f,e);this.persoanje=new $(this,0,s-s/4,i,1e3),this.persoanje.setDepth(this.PERSONAJE_DEPTH)}_load_nombre_personaje(){this.dialogo_data_selected.personaje!="none"}_load_buttons(t,s){this.buttons=[];let e=this.data_info_scene.get_img(f,this.BUTTON_CUADRADO_DIALOGO),i=this.cuadrado_dialogo.x+this.cuadrado_dialogo.width/2*this.cuadrado_dialogo.SCALE,a=this.cuadrado_dialogo.y-this.cuadrado_dialogo.height/2*this.cuadrado_dialogo.SCALE;for(this.buttons_index=1;this.buttons_index<=3&&this.dialogo_data_selected["texto_"+this.buttons_index];){let o=new K(this,i,a,e,this.dialogo_data_selected["texto_"+this.buttons_index],this.dialogo_data_selected["opcion_"+this.buttons_index],!0);o.setDepth(this.CUADRADO_DIALOGO_DEPTH+1),this.buttons_index++,a-=o.height,this.buttons.push(o),this.total_animations++}this.buttons_index=0}_set_events(){this.input.on("pointerup",this._mouse_up,this)}_remove_events(){this.input.off("pointerup",this._mouse_up,this)}_mouse_up(){if(this.animation_finished&&!this.dialogo_data_selected.opciones)if(this.dialogo_data_selected.opcion_1!="FIN")this.enter(this.dialogo_data_selected.opcion_1);else{let t={scene:this.dialogo_data_selected.texto_1,name:this.dialogo_data_selected.opcion_2};this.scene.get(p).signal_click(t)}}}class Z extends P{constructor(t,s,e,i){super(t,s,e,i,1,1),this.scene.add.existing(this),this.create()}create(){this.name_text=new T(this.scene,this.x,this.y,this,this.width," ",0,{fontSize:"24px",align:"center"}).setOrigin(.5,.5),this.exit()}exit(){super.exit(),this.visible=!1,this.name_text.visible=!1,this.clearTint()}enter(t,s){super.enter(),this.visible=!0,this.name_text.visible=!0,this.name_text.setText(t),s||this.setTint(8947848)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}finish_animation(){}move(t,s){s+=this.height*2,this.x=t,this.y=s,this.name_text.x=t,this.name_text.y=s}}class Q extends v{constructor(){super({key:b})}_reset_data(){}create(){this.scene_manager=this.scene.get(p),this._set_events(),this.movement_x=0,this.movement_y=0,this.can_move=!1,this.background=new Z(this,0,0,this.scene.get(m).get_img(b,"can_be_clicked")),this._set_events()}enter(t){this.edge_margin=t.edge_margin,this.move_speed=t.move_speed}_update(t,s){this.can_move&&this.scene_manager.move(this.movement_x*s,this.movement_y*s)}_set_events(){this.input.on("pointermove",this._mouse_move,this),this.input.on("pointerup",this._mouse_up,this)}_mouse_move(t){this.background.move(t.x,t.y);const s=this.edge_margin,e=this.move_speed;if(this.movement_x=0,this.movement_y=0,t.x<s){const i=(s-t.x)/s;this.movement_x=e*i}else if(t.x>this.sys.game.config.width-s){const i=(t.x-(this.sys.game.config.width-s))/s;this.movement_x=-e*i}if(t.y<s){const i=(s-t.y)/s;this.movement_y=e*i}else if(t.y>this.sys.game.config.height-s){const i=(t.y-(this.sys.game.config.height-s))/s;this.movement_y=-e*i}this.can_move=this.movement_x!==0||this.movement_y!==0}_mouse_up(){this.background.exit()}_load_background(){}cursor_entered(t,s){this.background.enter(t,s)}cursor_exited(t){this.background.exit(t)}}class M extends Phaser.Scene{constructor(t){super(t)}_update(t,s){}enter(){}exit(){}_set_event(t){}_remove_event(t){}game_created(){this.scene.get(_).game_created(this.scene.key)}start_game(){}finnish_game(){}}class y extends Phaser.Physics.Arcade.Sprite{constructor(t,s,e,i){super(t,s,e,i)}enter(){this._add_img(),this._set_colliders()}exit(){this.destroy()}_update(t,s){}_set_event(t){}_remove_event(t){}_set_colliders(t=.8,s=.8){let e=this.width*t,i=this.height*s,a=this.width*(1-t)/2,o=this.height*(1-s)/2;this.body.setSize(e,i),this.body.setOffset(a,o)}_add_img(){this.scene.add.existing(this),this.scene.physics.add.existing(this)}}class tt extends y{constructor(t,s,e,i,a,o){super(t,s,e,i),this.setScale(a,o)}enter(){super.enter(),this.setGravityY(800),this.setBounce(0),this.setCollideWorldBounds(!0)}exit(){super.exit()}_update(t,s){super._update(t,s)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class st extends y{constructor(t,s,e,i,a,o){super(t,s,e,i),this.setScale(a,o)}enter(){super.enter(),this.setVelocityX(-500),this.setGravityY(-600)}exit(){super.exit()}_update(t,s){super._update(t,s)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class et extends y{constructor(t,s,e,i,a,o){super(t,s,e,i),this.setScale(a,o)}enter(){super.enter(),this.setImmovable(!0),this.body.allowGravity=!1}exit(){super.exit()}_update(t,s){super._update(t,s)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,s=.8){}}class it extends y{constructor(t,s,e,i,a,o){super(t,s,e,i),this.setScale(a,o)}enter(){super.enter(),this.setImmovable(!0),this.body.allowGravity=!1}exit(){super.exit()}_update(t,s){super._update(t,s)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,s=.8){}}class R extends Phaser.GameObjects.Sprite{constructor(t,s,e,i){super(t,s,e,i),this.setOrigin(0,0),this.setInteractive(),this.total_clicks=0,this.clicks=0}enter(t=null){this.scene.add.existing(this),this.total_clicks++,this._set_events()}exit(){this._remove_events(),this.destroy()}next_frame(){this.clicks++,this.clicks>=this.total_clicks&&(this.clicks=0,this.action())}action(){}_set_events(){this.on("pointerup",this._mouse_up,this)}_remove_events(){this.off("pointerup",this._mouse_up,this)}_mouse_up(){this.next_frame()}}class at extends R{constructor(t,s,e,i){super(t,s,e,i)}action(){this.scene.start_game()}}let ot=class extends at{constructor(t,s,e,i){super(t,s,e,i)}};class nt extends R{constructor(t,s,e,i){super(t,s,e,i)}action(){this.scene.finnish_game()}}class rt extends nt{constructor(t,s,e,i){super(t,s,e,i)}}class ht extends M{constructor(t){super({key:D}),t={OVEJA_IMG:"oveja",VALLA_IMG:"valla",FONDO_IMG:"fondo",CIELO_IMG:"cielo",PANTALLA_INCIO:"pantalla_inicio",PANTALLA_FINAL:"pantalla_final"},this.OVEJA_IMG=t.OVEJA_IMG,this.VALLA_IMG=t.VALLA_IMG,this.FONDO_IMG=t.FONDO_IMG,this.CIELO_IMG=t.CIELO_IMG,this.PANTALLA_INCIO=t.PANTALLA_INCIO,this.PANTALLA_FINAL=t.PANTALLA_FINAL,this.OVEJITA_MUSICA="ovejitas",this.started=!1,this.vallasSaltadas=0}create(){this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.data_info_scene=this.scene.get(m),this.persoanl_best=this.data_info_scene.get_json("saves").Minijuegos.JuegoOveja.RecortdPuntuacion,this.datos_usuario=this.data_info_scene.get_datos_usaurio().Minijuegos.JuegoOveja,this.persoanl_best=this.datos_usuario.RecortdPuntuacion,this.musica=this.sound.add(this.data_info_scene.get_musica(this.OVEJITA_MUSICA),{loop:!0,volume:1}),this.musica.play(),this._crear_cielo(),this._crear_suelo(),this._crearOveja(),this._crear_marcador(),this._crear_pantalla_inicio(),this._crear_pantalla_final(),this.cursors=this.input.keyboard.createCursorKeys(),this.vallas=[],this.game_created()}enter(){super.enter(),this.pantalla_inicio.enter()}start_game(){this.pantalla_inicio.exit(),this.cielo.enter(),this.oveja.enter(),this.suelo.enter(),this.physics.add.collider(this.oveja,this.suelo),this.scheduleNextValla(),this.started=!0}finnish_game(){this.pantalla_final.exit(),this.persoanl_best<this.vallasSaltadas&&this.data_info_scene.guardar_puntuacion(this.scene.key,this.vallasSaltadas),this.exit()}_crear_cielo(){let t=0,s=0,e=this.data_info_scene.get_img(_,this.CIELO_IMG),i=this.SCREEN_WIDTH/768,a=this.SCREEN_HEIGHT/432;this.cielo=new it(this,t,s,e,i,a).setOrigin(0,0)}_crear_suelo(){let t=this.SCREEN_WIDTH/2,s=this.SCREEN_HEIGHT*.95,e=this.data_info_scene.get_img(_,this.FONDO_IMG),i=this.SCREEN_WIDTH/450,a=this.SCREEN_HEIGHT*.3/338;this.suelo=new et(this,t,s,e,i,a)}_crearOveja(){let t=175,s=this.SCREEN_HEIGHT*.75-100,e=this.data_info_scene.get_img(_,this.OVEJA_IMG),i=200/626,a=200/569;this.oveja=new tt(this,t,s,e,i,a)}_crear_pantalla_inicio(){let t=0,s=0,e=this.data_info_scene.get_img(_,this.PANTALLA_INCIO);this.pantalla_inicio=new ot(this,t,s,e)}_crear_pantalla_final(){let t=0,s=0,e=this.data_info_scene.get_img(_,this.PANTALLA_FINAL);this.pantalla_final=new rt(this,t,s,e)}_crear_marcador(){this.contadorTexto=this.add.text(this.SCREEN_WIDTH-50,50,`Saltadas: ${this.vallasSaltadas}`,{fontSize:"40px",fill:"#ffffff",fontFamily:"Impact"}).setOrigin(1,0).setDepth(1)}scheduleNextValla(){let t=1500,s=3e3;t=Math.max(600,1500-this.vallasSaltadas*50),s=Math.max(1200,3e3-this.vallasSaltadas*60);const e=Phaser.Math.Between(t,s);this.time.delayedCall(e,()=>{this._crear_valla(),this.scheduleNextValla()})}_crear_valla(){let t=this.SCREEN_WIDTH+50,s=this.SCREEN_HEIGHT*.75-50,e=this.data_info_scene.get_img(_,this.VALLA_IMG),i=300/626,a=300/358;this.valla=new st(this,t,s,e,i,a),this.valla.enter(),this.valla.contada=!1,this.physics.add.collider(this.oveja,this.valla,this.choque_function,null,this),this.vallas.push(this.valla)}_update(){this.started&&(this.oveja.body.blocked.down&&this.oveja.setVelocityY(0),this.cursors.space.isDown&&this.oveja.body.onFloor()&&this.oveja.setVelocityY(-1100),this.vallas.forEach(t=>{t&&t.x<this.oveja.x&&!t.contada&&(this.vallasSaltadas++,this.contadorTexto.setText(`Saltadas: ${this.vallasSaltadas}`),t.contada=!0),t&&t.x<-50&&t.exit()}))}choque_function(){this.started=!1,this.oveja.setTint(16711680),this.physics.pause(),this.time.removeAllEvents(),this.musica.stop();const t=this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Perdiste!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5).setDepth(1);setTimeout(()=>{this.pantalla_final.enter(this.vallasSaltadas),this.oveja.exit(),this.cielo.destroy(),this.vallas.forEach(s=>{s.exit()}),this.suelo.exit(),this.contadorTexto.destroy(),t.destroy()},2e3)}}class _t extends y{constructor(t,s,e,i,a,o){super(t,s,e,i),this.setScale(a,o)}enter(){super.enter(),this.setGravityY(800),this.setBounce(0),this.setCollideWorldBounds(!0)}exit(){super.exit()}_update(t,s){super._update(t,s)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class ct extends M{constructor(t){super({key:w}),t={PERSONA_IMG:"persona",OBSTACULO_IMG:"obstaculo",FONDO_IMG:"fondodisco"},this.PERSONA_IMG=t.PERSONA_IMG,this.OBSTACULO_IMG=t.OBSTACULO_IMG,this.FONDO_IMG=t.FONDO_IMG,this.DISCOTECA_MUSICA="disco",this.personawidth=1024,this.personaheight=1024,this.obstaculowidth=1024,this.obstaculoheight=1024,this.started=!1}create(){this.obstaculossaltados=0,this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.contadorTexto=this.add.text(this.SCREEN_WIDTH-50,50,`Puntuación: ${this.obstaculossaltados}`,{fontSize:"40px",fill:"#ffffff",fontFamily:"Impact"}).setOrigin(1,0).setDepth(1),this.data_info_scene=this.scene.get(m),this.musica=this.sound.add(this.data_info_scene.get_musica(this.DISCOTECA_MUSICA),{loop:!0,volume:1}),this.musica.play();let t=this.physics.add.sprite(0,0,this.data_info_scene.get_img(_,this.FONDO_IMG)).setOrigin(0,0);t.setScale(this.SCREEN_WIDTH/t.width,this.SCREEN_HEIGHT/t.height),t.setImmovable(!0),t.body.setAllowGravity(!1),this._crearPersona(),this.cursors=this.input.keyboard.createCursorKeys(),this.obstaculos=[],this.scheduleNextObstaculo(),this.game_created()}enter(){super.enter(),this.persona.enter(),this.started=!0}_crearPersona(){let t=175,s=this.SCREEN_HEIGHT*.5;this.persona=new _t(this,t,s,this.data_info_scene.get_img(_,this.PERSONA_IMG),200/this.personawidth,200/this.personaheight)}scheduleNextObstaculo(){const t=Phaser.Math.Between(1500,3e3);this.time.delayedCall(t,()=>{this.spawnObstaculo(),this.scheduleNextObstaculo()})}spawnObstaculo(){let t=300,s=350,e=this.SCREEN_WIDTH+100,i=100,a=this.SCREEN_HEIGHT-t-100,o=Phaser.Math.Between(i,a),n=o-t/2,h=this.SCREEN_HEIGHT-(o+t/2);this.tuboSuperior=this.physics.add.sprite(e,n/2,this.data_info_scene.get_img(_,this.OBSTACULO_IMG)).setScale(s/this.obstaculowidth,n/this.obstaculoheight),this.tuboSuperior.setFlipY(!0),this.tuboInferior=this.physics.add.sprite(e,o+t/2+h/2,this.data_info_scene.get_img(_,this.OBSTACULO_IMG)).setScale(s/this.obstaculowidth,h/this.obstaculoheight),this.tuboInferior.setVelocityX(-500),this.tuboInferior.setGravityY(-600),this.tuboSuperior.setVelocityX(-500),this.tuboSuperior.setGravityY(-600),this.tuboInferior.body.setSize(this.tuboInferior.width*.8,this.tuboInferior.height*.8),this.tuboInferior.body.setOffset(this.tuboInferior.width*.1,this.tuboInferior.height*.1),this.tuboSuperior.body.setSize(this.tuboSuperior.width*.8,this.tuboSuperior.height*.8),this.tuboSuperior.body.setOffset(this.tuboSuperior.width*.1,this.tuboSuperior.height*.1),this.physics.add.collider(this.persona,this.tuboInferior,()=>{this.persona.setTint(16711680),this.physics.pause(),this.time.removeAllEvents(),this.musica.stop(),this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Perdiste!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5)}),this.physics.add.collider(this.persona,this.tuboSuperior,()=>{this.persona.setTint(16711680),this.physics.pause(),this.time.removeAllEvents(),this.musica.stop(),this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Perdiste!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5)}),this.obstaculos.push({superior:this.tuboSuperior,inferior:this.tuboInferior,contado:!1})}_update(){this.started&&(this.persona.body.blocked.down&&this.persona.setVelocityY(0),Phaser.Input.Keyboard.JustDown(this.cursors.space)&&this.persona.setVelocityY(-600),this.obstaculos.forEach(t=>{const s=t.inferior;s.x<this.persona.x&&!t.contado&&(this.obstaculossaltados++,this.contadorTexto.setText(`Puntuación: ${this.obstaculossaltados}`),t.contado=!0),s.x<-s.width&&(t.superior.destroy(),t.inferior.destroy())}))}}class lt extends v{constructor(){super({key:_})}_reset_data(){this.current_minigame=null}create(){this.data_info_scene=this.scene.get(m),this.scene_created()}enter(t){super.enter(t)&&this.start_minigame(t)}exit(){super.exit()&&this.exit_minigame()}start_minigame(t){this.current_minigame&&this.current_minigame.scene.stop(),this.add_scene_minijuego(t,this.get_minijuego(t))}exit_minigame(){this.current_minigame&&(this.current_minigame.scene.stop(),this.current_minigame=null)}_update(){this.current_minigame&&this.current_minigame._update()}open_dialog(t){this.scene.get(f).enter(t)}game_created(){this.current_minigame.enter()}add_scene_minijuego(t,s){this.scene.get(t)&&this.scene.remove(t),this.scene.add(t,s,!1),this.scene.launch(t),this.current_minigame=this.scene.get(t)}get_minijuego(t){switch(t){case D:return ht;case w:return ct;default:return null}}}class N extends P{constructor(t,s,e,i,a,o,n,h,c,l){super(t,s,e,i,a,o,c),this.game_object_data={alpha:this.alpha,scaleX:this.scaleX,scaleY:this.scaleY,pos_x:this.x,pos_y:this.y},this.delay=n,this.anitmation_info=h,h&&(this.animation=new O(t)),this.nombre=l}_reset_varaibles(){super._reset_varaibles(),this.nombre="",this.on_click=null,this.animation=null}finish_animation(){this.scene.finish_animation()}exit(){super.exit()}enter(){super.enter(),setTimeout(()=>{this._add_sprite(this.anitmation_info)},this.delay)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}_start_animation(){super._start_animation()}_stop_animation(){super._stop_animation()}_set_events(){super._set_events()}_remove_events(){super._remove_events()}_mouse_enter(){super._mouse_enter()}_mouse_over(){super._mouse_over()}_mouse_out(){super._mouse_out()}_mouse_down(){super._mouse_down()}_mouse_up(){super._mouse_up(),this.scene.signal_click(this.on_click)}_mouse_move(){super._mouse_move()}before_destroy(){super.before_destroy()}}class ut extends N{constructor(t,s,e,i,a,o,n,h,c){super(t,s,e,i,a,a,o,n,h,c)}}class dt extends N{constructor(t,s,e,i,a,o){super(t,s,e,i,1,1,0,null,a,o)}}class pt extends N{constructor(t,s,e,i,a,o){super(t,s,e,i,1,1,0,null,a,o)}}class mt extends v{constructor(){super({key:g}),this.PISO_MUSICA="tema_inicial",this.BACKGROUND_DEPTH=0,this.PUERTAS_DEPTH=1,this.OBJETOS_DEPTH=1,this.NPCS_DEPTH=2,this.PROTA_DEPTH=3,this.MUSIC_VOLUME=.1,this.MUSIC_LOOP=!0,this._reset_variables(),this.interactuables_animations={},this.npcs_array=[],this.puertas=[],this.objetos=[]}_reset_variables(){this.offset_x=0,this.offset_y=0,this.can_move=!1,this.animation_finished=!1,this.total_animations=0,this.animations_finished=0,this.move_limit_x=0,this.move_limit_y=0}create(){this.data_info_scene=this.scene.get(m),this.data=this.data_info_scene.get_data_json(),this.data_json=this.data.Json,this.pantallas_data=this.data_info_scene.get_json(this.data_json.Pantallas),this.musica=this.sound.add(this.data_info_scene.get_musica(this.PISO_MUSICA),{loop:this.MUSIC_LOOP,volume:this.MUSIC_VOLUME}),this.scene_created()}move(t,s){if(!this.animation_finished)return;let e=this.offset_x+t,i=this.offset_y+s;e=Phaser.Math.Clamp(e,-this.move_limit_x,this.move_limit_x),i=Phaser.Math.Clamp(i,-this.move_limit_y,this.move_limit_y);const a=e-this.offset_x,o=i-this.offset_y;this.offset_x=e,this.offset_y=i,a!==0&&(this.background&&(this.background.x+=a),this.prota&&(this.prota.x+=a),this.npcs_array.forEach(n=>n.x+=a),this.puertas&&this.puertas.forEach(n=>n.x+=a),this.objetos&&this.objetos.forEach(n=>n.x+=a)),o!==0&&(this.background&&(this.background.y+=o),this.prota&&(this.prota.y+=o),this.npcs_array.forEach(n=>n.y+=o),this.puertas&&this.puertas.forEach(n=>n.y+=o),this.objetos&&this.objetos.forEach(n=>n.y+=o))}_load_pantalla(t){this.pantalla_data=this.pantallas_data[t],this.sys.game.canvas,this._load_background(),this._load_npcs(),this._load_prota(),this._load_puertas(),this._load_objetos()}exit(){super.exit(),this.prota&&this.prota.exit(),this.background&&this.background.destroy(),this.npcs_array.forEach(t=>{t.exit()}),this.puertas.forEach(t=>{t.exit()}),this.objetos.forEach(t=>{t.exit()}),this.musica.stop()}enter(t){super.enter(t)&&(this.musica.isPlaying||this.musica.play(),this._reset_variables(),this._load_pantalla(t),this.move_limit_x=(this.background.displayWidth-this.sys.game.canvas.width)/2,this.move_limit_y=(this.background.displayHeight-this.sys.game.canvas.height)/2,this.animation_finished=!0,this.move(-this.move_limit_x,-this.move_limit_y),this.animation_finished=!1,this.offset_x=0,this.offset_y=0,this.pause())}_update(t,s){super._update()}pause(){super.pause(),this.prota&&this.prota.pause(),this.npcs_array.forEach(t=>{t.pause()})}unpause(){super.unpause(),this.prota&&this.prota.unpause(),this.npcs_array.forEach(t=>{t.unpause()}),this.puertas.forEach(t=>{t.unpause()}),this.objetos.forEach(t=>{t.unpause()})}starting_animation(){this.pause()}finish_animation(){this.animations_finished++,this.animations_finished==this.total_animations&&(this.animation_finished=!0,this.unpause())}signal_click(t){t.scene=="pantalla"?(this.exit(),this.enter(t.name)):this.scene.get(p).signal_click(t)}_load_background(){let t=this.data_info_scene.get_img(g,this.pantalla_data.background);this.background=this.add.image(0,0,t).setOrigin(0,0),this.background.setDepth(this.BACKGROUND_DEPTH)}_load_npcs(){this.npcs_array.length>0&&this.npcs_array.forEach(s=>{s.destroy()}),this.npcs_array=[];let t=this.pantalla_data.npcs;Object.keys(t).forEach(s=>{this.npcs_array.push(this._load_personaje(t[s])),this.npcs_array[this.npcs_array.length-1].setDepth(this.NPCS_DEPTH),this.npcs_array[this.npcs_array.length-1].enter()})}_load_prota(){this.prota=this._load_personaje(this.pantalla_data.prota),this.prota.setDepth(this.PROTA_DEPTH),this.prota.enter()}_load_personaje(t){let s=t.nombre,e=t.pose,i=t.pos_x,a=t.pos_y,o=t.size,n=t.delay,h=t.animation,c=t.on_click,l=this.data_info_scene.get_img(g,s+"_"+e);return this.total_animations++,new ut(this,i,a,l,o,n,h,c,s)}_load_puertas(){this.puertas&&this.puertas.forEach(s=>{s.destroy()});let t=this.pantalla_data.puertas;this.puertas=[],Object.keys(t).forEach(s=>{let e=t[s].nombre,i=t[s].pos_x,a=t[s].pos_y,o=t[s].on_click,n=this.data_info_scene.get_img(g,s),h=new dt(this,i,a,n,o,e).setDepth(this.PUERTAS_DEPTH);h.enter(),this.total_animations++,this.puertas.push(h)})}_load_objetos(){this.objetos&&this.objetos.forEach(s=>{s.destroy()});let t=this.pantalla_data.objetos;this.objetos=[],Object.keys(t).forEach(s=>{let e=t[s].nombre,i=t[s].pos_x,a=t[s].pos_y,o=t[s].on_click,n=this.data_info_scene.get_img(g,s),h=new pt(this,i,a,n,o,e);h.setDepth(this.OBJETOS_DEPTH),h.enter(),this.objetos.push(h)})}}const ft={apiKey:"AIzaSyCL31kN-RfrF8CiPhiPnxZmGmfYVUI3tV4",authDomain:"bitbybit-43aee.firebaseapp.com",projectId:"bitbybit-43aee",storageBucket:"bitbybit-43aee.firebasestorage.app",messagingSenderId:"494311902150",appId:"1:494311902150:web:0e6b80bc1889ca702dc0c7"},k=U(ft),gt=J(k),A=V(k),xt=new B;async function vt(){try{const t=(await F(gt,xt)).user;return console.log("✅ Sesión iniciada:",t.displayName),t}catch(r){return console.error("❌ Error al iniciar sesión:",r),null}}async function L(r,t){try{await C(E(A,"progresos",r),{...t,actualizado:Y()}),console.log("✅ Progreso guardado correctamente")}catch(s){console.error("❌ Error al guardar:",s)}}async function H(r){try{const t=E(A,"progresos",r),s=await I(t);return s.exists()?(console.log("✅ Progreso cargado correctamente"),s.data()):(console.log("⚠️ No hay progreso guardado aún."),null)}catch(t){return console.error("❌ Error al cargar:",t),null}}async function bt(r,t){const s=E(A,"rankings","record_minijuegos");try{(await I(s)).exists()?(await z(s,{[r]:t}),console.log(`✅ Ranking actualizado para ${r}`)):(await C(s,{Minijuegos:{[r]:t}}),console.log(`📄 Documento creado con ranking para ${r}`))}catch(e){console.error("❌ Error al guardar ranking:",e)}}async function yt(){try{const r=E(A,"rankings","record_minijuegos"),t=await I(r);return t.exists()?(console.log("✅ Ranking cargado correctamente"),t.data()||null):(console.log("⚠️ No hay ranking guardado aún."),null)}catch(r){return console.error("❌ Error al cargar ranking:",r),null}}class St extends Phaser.Scene{constructor(){super(S)}create(){const t=this.cameras.main.centerX,s=this.cameras.main.centerY;this.texto1=this.add.text(t,s-100,"Inicia sesión con Google",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.loginButton=this.add.rectangle(t,s,300,60,4359668).setInteractive({useHandCursor:!0}).on("pointerdown",async()=>{const e=await vt();if(e){const i=e.uid;let a=await H(i);a||(a={Saves:{Pantalla:"demo_salon_1",Dialogo:"tutorial1",Minijuegos:{JuegoOveja:{RecortdPuntuacion:-2}}}},await L(i,a)),this.scene.get(p).agregar_scenes({userId:i,displayName:e.displayName,progreso:a})}else this.mostrarError("Inicio de sesión cancelado o fallido")}),this.texto2=this.add.text(t,s,"Google Login",{fontSize:"24px",color:"#ffffff"}).setOrigin(.5)}mostrarError(t){const s=this.cameras.main.centerX;this.texto3=this.add.text(s,500,t,{fontSize:"20px",color:"#ff5555"}).setOrigin(.5)}shutdown(){this.texto1.destroy(),this.texto2.destroy(),this.texto3&&this.texto3.destroy(),this.loginButton.removeAllListeners("pointerdown"),this.loginButton.destroy(),console.log("LoginScene destroyed")}}class Et extends v{constructor(){super({key:p}),this.scenes={},this.currentScene=null,this.currentSceneData=null,this.cursor_data={edge_margin:200,move_speed:1}}create(){this.data_info_scene=this.scene.get(m),this.data=this.data_info_scene.get_data_json(),this.data_json=this.data.Json,this.saves_data=this.data_info_scene.get_json(this.data_json.Saves),this.scene.add(S,St,!1),this.scene.launch(S)}agregar_scenes(t){this.scene.stop(S),this.data_info_scene.save_firestore_data(t),this.events.on(G,this.scene_created,this),this.add_scene(g,mt),this.add_scene(f,q),this.add_scene(_,lt,"JuegoOveja"),this.add_scene(b,Q),this.cursor=this.scenes[b],this.cursor.enter(this.cursor_data)}add_scene(t,s,e=null){this.scene.get(t)&&this.scene.remove(t),this.scene.add(t,s,!1),this.scene.launch(t),this.scenes[t]=this.scene.get(t),e&&(this.currentScene=t,this.currentSceneData=e)}signal_click(t){this.scenes[this.currentScene].exit(),this.currentScene=this._get_next_scene(t.scene),this.scenes[this.currentScene].enter(t.name)}scene_created(t){t==this.currentScene?this.scenes[t].enter(this.currentSceneData):this.scenes[t].exit()}_get_next_scene(t){switch(t){case"dialogo":return f;case"pantalla":return g;case"minijuego":return _}}cursor_entered(t,s){this.cursor.cursor_entered(t,s)}cursor_exited(t){this.cursor.cursor_exited(t)}move(t,s){this.scenes[this.currentScene].move(t,s)}exit(){this.pause()}enter(t){this.unpause()}update(t,s){this.currentScene&&(this.scenes[this.currentScene]._update(t,s),this.cursor._update(t,s))}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}}class Ot extends Phaser.Scene{constructor(){super({key:m,active:!0}),this.ROOT="/DVI/",this.ASSETS_PATH=this.ROOT+"assets/",this.JSON_PATH=this.ASSETS_PATH+"json/",this.IMG_PATH=this.ASSETS_PATH+"img/",this.json_data="json_data",this.data_name="data.json",this.asdasd=0}preload(){this.load.json(this.json_data,this.JSON_PATH+this.data_name)}create(){this.data=this.cache.json.get(this.json_data).Assets,this.data_json=this.data.Json,this.data_imgs=this.data.Imgs,this.data_musica=this.data.Musica,this.ROOT=this.data.Root,this.ASSETS_PATH=this.ROOT+this.data.Path,this.JSON_PATH=this.ASSETS_PATH+this.data_json.Path,this.IMG_PATH=this.ASSETS_PATH+this.data_imgs.Path,this.MUSICA_PATH=this.ASSETS_PATH+this.data_musica.Path,this.json_prefix=this.data_json.Prefix,this.img_prefix=this.data_imgs.Prefix,this.musica_prefix=this.data_musica.Prefix;let t=this.data_json.Folders;this.load.on("filecomplete",()=>{this.loaded||(this.loaded=!0,this.crear_laoding_screen(),this.get_number_assets(),this.load_assets())}),this.load.json(this.json_prefix+t,this.JSON_PATH+t+this.data_json.Suffix),this.load.start()}crear_laoding_screen(){const{width:t,height:s}=this.scale;this.loading_box=this.add.graphics(),this.loading_box.fillStyle(2236962,.8),this.loading_box.fillRect(t/2-t/4,s/2-20,t/2,200),this.loading_bar=this.add.graphics(),this.bar_x=t/2-t/4+10,this.bar_y=s/2-10,this.bar_width=t/2-20,this.bar_height=180}get_number_assets(){const t=this.cache.json.get(this.json_prefix+this.data_json.Folders);this.number_assets=this.get_number_assets_recursive(t),this.loaded_assets=0}get_number_assets_recursive(t){let s=0;return t.folders.forEach(e=>{s+=this.get_number_assets_recursive(e)}),s+=t.files.length,s}update_loading_bar(t){this.loading_bar.clear(),this.loading_bar.fillStyle(16777215,1),this.loading_bar.fillRect(this.bar_x,this.bar_y,this.bar_width*t,this.bar_height)}load_assets(){this.load.on("progress",t=>{this.update_loading_bar(t)}),this.load.on("complete",()=>{setTimeout(()=>{this.scene.start(p)},100)}),this.load_jsons(),this.load_imgs(),this.load_musicas(),this.load.start()}load_jsons(){this.data_json.Jsons.forEach(s=>{this.load_json(s)})}load_json(t){const s=this.data_json.Suffix;this.load.json(this.json_prefix+t,this.JSON_PATH+t+s)}get_data_json(){return this.cache.json.get(this.json_data).Assets}get_json(t){let s=t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("");return this.cache.json.get(this.json_prefix+t)[s]}load_imgs(){this.data_imgs.Clases.forEach(s=>{this.data_imgs[s].Clases.forEach(i=>{this.data_imgs[s][i][i].forEach(o=>{this.laod_img(s,i,o)})})})}laod_img(t,s,e){let i="";switch(s){case"Backgrounds":i=this.data_imgs[t].Path+this.data_imgs[t][s].Path+e+"/",this.load_img2(t,e,i);break;case"Personajes":this.data_imgs[t][s].Poses.forEach(n=>{i=this.data_imgs[t].Path+this.data_imgs[t][s].Path+e+"/",this.load_img2(t,e+"_"+n,i)});break;case"JuegoOveja":case"JuegoDiscoteca":case"Dialogos":case"Cursors":i=this.data_imgs[t].Path+this.data_imgs[t][s].Path,this.load_img2(t,e,i);break;case"Puertas":this.data_imgs[t][s].Lados.forEach(n=>{i=this.data_imgs[t].Path+this.data_imgs[t][s].Path+e+"/",this.load_img2(t,e+"_"+n,i)});break;case"Objetos":i=this.data_imgs[t].Path+this.data_imgs[t][s].Path,this.load_img2(t,e,i);break;default:console.log("Clase no encontrada",t,s,e);break}}load_img2(t,s,e){const i=this.data_imgs.Suffix;this.load.image(this.img_prefix+t+"_"+s,this.IMG_PATH+e+s+i)}load_musicas(){this.data_musica.Musicas.forEach(s=>{this.load_musica(s)})}load_musica(t){const s=this.data_musica.Suffix;this.load.audio(this.musica_prefix+t,this.MUSICA_PATH+t+s)}get_musica(t){return this.musica_prefix+t}get_img(t,s){let e="";switch(t){case g:case"Pantallas":e="Pantallas";break;case f:case"Dialogos":e="Dialogos";break;case _:case"Minijuegos":e="Minijuegos";break;case b:case"Cursors":e="Cursors";break}return this.img_prefix+e+"_"+s}save_firestore_data(t){this.userId=t.userId,this.userName=t.displayName,this.progreso=t.progreso,this.cargar_datos_usuario(),this.cargar_rankings()}guardar_puntuacion(t,s){if(!this.userId||!this.progreso){console.error("⚠️ No hay sesión activa o progreso cargado.");return}if(this.progreso.Saves||(this.progreso.Saves={}),this.progreso.Saves.Minijuegos||(this.progreso.Saves.Minijuegos={}),!this.progreso.Saves.Minijuegos[t]){this.progreso.Saves.Minijuegos[t]={RecortdPuntuacion:s};return}const e=this.progreso.Saves.Minijuegos[t].RecortdPuntuacion;s<=e||(this.progreso.Saves.Minijuegos[t].RecortdPuntuacion=s,L(this.userId,this.progreso),this.actualizar_ranking(t,s))}cargar_datos_usuario(){if(!this.userId){console.error("⚠️ No hay sesión activa.");return}H(this.userId).then(t=>{t?(this.progreso=t,console.log("✅ Datos de usuario cargados:",this.progreso)):console.error("⚠️ No se encontraron datos para el usuario.")}).catch(t=>{console.error("❌ Error al cargar datos:",t)})}cargar_rankings(){if(!this.userId){console.error("⚠️ No hay sesión activa.");return}yt().then(t=>{t?(this.ranking=t,console.log("✅ Rankings cargados:",this.ranking)):console.error("⚠️ No se encontraron rankings para el usuario.")}).catch(t=>{console.error("❌ Error al cargar rankings:",t)})}get_datos_usaurio(){return this.progreso.Saves}get_ranking(t){return this.ranking[t]||null}async actualizar_ranking(t,s){if(!this.userId||!this.ranking){console.error("⚠️ No hay sesión activa o ranking cargado.");return}this.ranking[t]||(console.log("⚠️ No existía ranking para",t),this.ranking[t]=[]);let e=this.ranking[t];e=e.filter(n=>n.Nombre!==this.userName),e.push({Nombre:this.userName,Puntuacion:s}),e.sort((n,h)=>h.Puntuacion-n.Puntuacion);const i=e.slice(0,10),a=JSON.stringify(this.ranking[t]),o=JSON.stringify(i);if(a===o){console.log("🔁 El ranking no ha cambiado, no se guarda.");return}this.ranking[t]=i,console.log("✅ Ranking actualizado para",t),await bt(t,i)}}const At={width:1820,height:1358,parent:"juego",physics:{default:"arcade",arcade:{gravity:{y:600},debug:!1}},scene:[Ot,v,Et],scale:{mode:Phaser.Scale.EXACT_FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(At);
