(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(e){if(e.ep)return;e.ep=!0;const a=s(e);fetch(e.href,a)}})();const R="Bootloader",P="ScenePlay",l="SceneManager",g="Pantallas",m="Dialogo",u="event_texto_dialogo",p="event_skip_texto_dialogo",A="event_next_texto_dialogo",N="event_datos_cargados",I="event_start_dialogo",S="event_start_pantalla",f="event_animation_interactable_finished";class E extends Phaser.GameObjects.Text{constructor(t,s,i,e,a,h,o,_,r={}){let c={fontSize:"32px",fontFamily:"Arial",color:"#000000",align:"left",lineSpacing:10,wordWrap:{width:i-20}};if(r={...c,...r},super(t,e,a,"",r),this.scene.events.on(p,this.stop_animation,this),this.parent=s,this.playing_animation=!0,this.setOrigin(0,0),o){let d=t.add.text(this.x,this.y,h,c);this.x-=d.width/2,d.destroy()}t.add.existing(this),_?(this.setText(h),this.scene.events.emit(u)):this.actualizar_texto(h)}actualizar_texto(t){this.setText(""),this.parent.texto_finnished=!1,this.animacion_texto(t)}stop_animation(){this.playing_animation=!1}animacion_texto(t){let s=0,i="",e=t;setTimeout(()=>{let a=setInterval(()=>{if(!this.playing_animation){clearInterval(a),this.setText(t),this.playing_animation=!0,this.parent.texto_finnished=!0,this.scene.events.emit(u);return}i+=e[s],this.setText(i),s++,s===e.length&&(clearInterval(a),this.parent.texto_finnished=!0,this.scene.events.emit(u))},50)},100)}}class L extends Phaser.GameObjects.Sprite{constructor(t,s,i,e,a,h){super(t,s,i,e),this.texto_finnished=!1,this.tween_finnish=!1,t.add.existing(this),h?this.tween_finnished(t,s,i,a,h):(this.scaleX=0,this.scaleY=0,this.alpha=0,this.scene_tween=t.tweens.add({targets:this,scaleX:1,scaleY:1,alpha:1,duration:1e3,ease:"Power2",onComplete:()=>{this.tween_finnish=!0,this.tween_finnished(t,s,i,a,h)}}))}tween_finnished(t,s,i,e,a){this.texto_dialogo=new E(t,this,this.width-10,s-this.width/2+20,i-this.height/2+20,e,!1,a,{})}actualizar_texto(t){this.texto_dialogo&&this.texto_dialogo.destroy(),setTimeout(()=>{this.texto_dialogo=new E(this.scene,this,this.width-10,this.x-this.width/2+20,this.y-this.height/2+20,t,!1,!1,{})},10)}}class D extends Phaser.GameObjects.Sprite{constructor(t,s,i,e,a,h,o){super(t,s,i,e),this.texto_finnished=!1,this.tween_finnish=!1,this.can_be_clicked=!1,this.setInteractive(),this.setOrigin(0,.5),this.set_event(a),t.add.existing(this),this.x=s-this.width,o?this.tween_finnished(t,s,i,h,o):(this.scaleX=0,this.alpha=0,this.scene_tween=t.tweens.add({targets:this,scaleX:1,alpha:1,duration:200,ease:"Power2",onComplete:()=>{this.tween_finnish=!0,this.tween_finnished(t,s,i,h,o)}})),this.scene.events.on(p,()=>{if(!this.texto_finnished&&(o=!0,this.scene_tween)){if(this.scene_tween.stop(),this.scaleX=1,this.alpha=1,this.tween_finnish)return;this.tween_finnished(t,s,i,h,!0)}},this),this.on("destroy",this.beforeDestroy,this)}tween_finnished(t,s,i,e,a){this.setOrigin(1,.5),this.x=this.x+this.width,this.texto=new E(t,this,this.width-10,s-this.width/2,i,e,!0,a,{}).setOrigin(0,.5)}set_event(t){this.once("pointerdown",()=>{this.can_be_clicked&&this.scene.events.emit(A,t)}),this.on("pointerover",()=>{if(!this.can_be_clicked)return;this.setTint(7895160),this.scene.scene.get(l).change_cursor("selected")}),this.on("pointerout",()=>{this.clearTint(),this.scene.scene.get(l).change_cursor("normal")})}actualizar_texto(t){this.texto.actualizar_texto(t)}stop_animation(){this.texto.stop_animation()}beforeDestroy(){this.texto.destroy()}}class w extends Phaser.GameObjects.Sprite{constructor(t,s,i,e){super(t,s,i,""),this.add_personaje(t,e)}change_texture(t){this.setTexture(t)}add_personaje(t,s){this.change_texture(s),this.setOrigin(0,1),this.setScale(2),t.add.existing(this)}}class y extends Phaser.GameObjects.Sprite{constructor(t,s,i,e){super(t,s,i,""),this.add_background(t,e)}change_texture(t){this.setTexture(t)}add_background(t,s){this.change_texture(s),this.setOrigin(0,0),t.add.existing(this)}}class O{constructor(t){this.scene=t,this.ASSETS="Assets",this.PATH="Path",this.PREFIX="Prefix",this.EXTENSION="Extension",this.IMAGES="Images",this.JSON="Json",this.COLLIDER="Collider",this.DIALOGOS="Dialogos",this.PANTALLAS="Pantallas",this.CURSOR="Cursor",this.PERSONAJES="Personajes",this.POSES="Poses",this.BACKGROUNDS="Backgrounds",this.JSON_PREFIX="json_",this.FORMATO_JSON=".json",this.JSON_PATH="/BitByBit/docs/assets/json/",this.inicializar_constantes_datos()}inicializar_constantes_datos(){this.JSON_DATO="data",this.JSON_DATO_PATH=this.JSON_PATH+this.JSON_DATO+this.FORMATO_JSON}cargar_datos(){this.scene.load.json(this.JSON_PREFIX+this.JSON_DATO,this.JSON_DATO_PATH),this.scene.load.once(`filecomplete-json-${this.JSON_PREFIX+this.JSON_DATO}`,()=>{this.datos=this.scene.cache.json.get(this.JSON_PREFIX+this.JSON_DATO),this.datos_assets=this.datos.Assets,this.scene.events.emit(N)}),this.scene.load.start()}recargar_datos(){this.datos=this.scene.cache.json.get(this.JSON_PREFIX+this.JSON_DATO),this.datos&&(this.datos_assets=this.datos.Assets)}get_json_dato(){return this.JSON_PREFIX+this.JSON_DATO}cargar_dialogos(){let t=this.datos_assets[this.JSON][this.PREFIX];this.json_dialogo=t+this.datos_assets[this.JSON][this.DIALOGOS],this.json_dialogo_path=this.datos_assets[this.JSON][this.PATH]+this.datos_assets[this.JSON][this.DIALOGOS]+this.datos_assets[this.JSON][this.EXTENSION],this.scene.load.json(this.json_dialogo,this.json_dialogo_path)}get_json_dialogo(){return this.datos_assets[this.JSON][this.PREFIX]+this.datos_assets[this.JSON][this.DIALOGOS]}get_json_dialogo_path(){this.json_dialogo_path}cargar_pantallas(){this.json_pantalla=this.datos_assets[this.JSON][this.PREFIX]+this.datos_assets[this.JSON][this.PANTALLAS];let t=this.datos_assets[this.JSON][this.PATH]+this.datos_assets[this.JSON][this.PANTALLAS]+this.datos_assets[this.JSON][this.EXTENSION];this.scene.load.json(this.json_pantalla,t)}get_json_pantalla(){return this.datos_assets[this.JSON][this.PREFIX]+this.datos_assets[this.JSON][this.PANTALLAS]}cargar_img_collider(){this.collider=this.datos_assets[this.IMAGES][this.COLLIDER][this.COLLIDER];let t=this.datos_assets[this.IMAGES][this.COLLIDER][this.PATH];this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.collider+"_"+this.COLLIDER,t+this.collider+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.collider+"_debug_"+this.COLLIDER,t+this.collider+"_debug"+this.datos_assets[this.IMAGES][this.EXTENSION])}get_collider(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.COLLIDER][this.COLLIDER]+"_"+this.COLLIDER}get_collider_debug(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.COLLIDER][this.COLLIDER]+"_debug_"+this.COLLIDER}cargar_img_cursor(){let t=this.datos_assets[this.IMAGES][this.CURSOR][this.PATH];this.cursor=this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR],this.cursor_selected=this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_selected",this.cursor_left=this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_left",this.cursor_right=this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_right",this.background_cursor=this.datos_assets[this.IMAGES][this.CURSOR].Background,this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.cursor+"_"+this.CURSOR,t+this.cursor+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.cursor+"_selected_"+this.CURSOR,t+this.cursor+"_selected"+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.cursor+"_left_"+this.CURSOR,t+this.cursor+"_left"+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.cursor+"_right_"+this.CURSOR,t+this.cursor+"_right"+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+this.background_cursor+"_"+this.CURSOR,t+this.background_cursor+this.datos_assets[this.IMAGES][this.EXTENSION])}get_cursor(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_"+this.CURSOR}get_cursor_selected(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_selected_"+this.CURSOR}get_cursor_left(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_left_"+this.CURSOR}get_cursor_right(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.CURSOR][this.CURSOR]+"_right_"+this.CURSOR}get_background_cursor(){return this.datos_assets[this.IMAGES][this.PREFIX]+this.datos_assets[this.IMAGES][this.CURSOR].Background+"_"+this.CURSOR}cargar_img_dialogos(){let t=this.datos_assets[this.IMAGES][this.DIALOGOS][this.DIALOGOS][this.PATH];this.CUADRADO_DIALOGO=this.datos_assets[this.IMAGES][this.DIALOGOS][this.DIALOGOS].CuadradoDialogo,this.BOTON_DIALOGO=this.datos_assets[this.IMAGES][this.DIALOGOS][this.DIALOGOS].BotonDialogo,this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+"_"+this.CUADRADO_DIALOGO,t+this.CUADRADO_DIALOGO+this.datos_assets[this.IMAGES][this.EXTENSION]),this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+"_"+this.BOTON_DIALOGO,t+this.BOTON_DIALOGO+this.datos_assets[this.IMAGES][this.EXTENSION])}get_cuadrado_dialogo(){return this.datos_assets[this.IMAGES][this.PREFIX]+"_"+this.CUADRADO_DIALOGO}get_boton_dialogo(){return this.datos_assets[this.IMAGES][this.PREFIX]+"_"+this.BOTON_DIALOGO}cargar_personajes_dialogos(){let t=this.datos_assets[this.IMAGES][this.DIALOGOS][this.PERSONAJES][this.PATH],s=this.datos_assets[this.IMAGES][this.DIALOGOS][this.PERSONAJES][this.POSES],i=this.datos_assets[this.IMAGES][this.DIALOGOS][this.PERSONAJES][this.PERSONAJES];for(let e=0;e<i.length;e++)for(let a=0;a<s.length;a++){let h=i[e]+"_"+s[a],o=t+i[e]+"/"+h+this.datos_assets[this.IMAGES][this.EXTENSION];this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+h+"_"+this.DIALOGOS,o)}}get_personaje_dialogos(t,s){return this.datos_assets[this.IMAGES][this.PREFIX]+t+"_"+s+"_"+this.DIALOGOS}cargar_backgrounds_dialogos(){let t=this.datos_assets[this.IMAGES][this.DIALOGOS][this.BACKGROUNDS][this.PATH],s=this.datos_assets[this.IMAGES][this.DIALOGOS][this.BACKGROUNDS][this.BACKGROUNDS];for(let i=0;i<s.length;i++){let e=t+s[i]+this.datos_assets[this.IMAGES][this.EXTENSION];this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+s[i]+"_"+this.DIALOGOS,e)}}get_background_dialogos(t){return this.datos_assets[this.IMAGES][this.PREFIX]+t+"_"+this.DIALOGOS}cargar_backgrounds_pantallas(){let t=this.datos_assets[this.IMAGES][this.PANTALLAS][this.BACKGROUNDS][this.PATH],s=this.datos_assets[this.IMAGES][this.PANTALLAS][this.BACKGROUNDS][this.BACKGROUNDS];for(let i=0;i<s.length;i++){let e=t+s[i]+this.datos_assets[this.IMAGES][this.EXTENSION];this._cargar_imagen(this.datos_assets[this.IMAGES][this.PREFIX]+s[i]+"_"+this.PANTALLAS,e)}}get_background_pantallas(t){return this.datos_assets[this.IMAGES][this.PREFIX]+t+"_"+this.PANTALLAS}_cargar_imagen(t,s){this.scene.load.image(t,s)}}class v extends Phaser.Scene{constructor(){super({key:m,active:!1}),this.assets_data=new O(this)}init(t){this.assets_data.recargar_datos(),this.texto_finalizado=!1,this.nombre_dialogo=t,this.dialogo_data=this.cache.json.get(this.assets_data.get_json_dialogo()).Dialogo,this.skip_animation=!1,this.can_be_clicked=!1}preload(){this.assets_data.cargar_img_dialogos(),this.assets_data.cargar_personajes_dialogos(),this.assets_data.cargar_backgrounds_dialogos(),setTimeout(()=>{this.can_be_clicked=!0},100)}create(){this.width=this.sys.game.config.width,this.height=this.sys.game.config.height,this.background=new y(this,0,0,this.assets_data.get_background_dialogos(this.dialogo_data[this.nombre_dialogo].fondo)),this.cuadro_dialogo=new L(this,this.width/2,this.height-150,this.assets_data.get_cuadrado_dialogo(),this.dialogo_data[this.nombre_dialogo].texto,!1),this.cursor=this.input.keyboard.createCursorKeys(),this.añadir_botones();let t=this.cuadro_dialogo.x-this.cuadro_dialogo.width/4-50,s=this.cuadro_dialogo.y-this.cuadro_dialogo.height/2,i=this.assets_data.get_personaje_dialogos(this.dialogo_data[this.nombre_dialogo].npc,this.dialogo_data[this.nombre_dialogo].pose);this.personaje=new w(this,t,s,i),this.input.on("pointerdown",this.on_click,this),this.events.on(A,this.on_next_dialogo_text,this)}async añadir_botones(){let t=0,s=this.width-(this.width-this.cuadro_dialogo.width)/2,i=this.height-this.cuadro_dialogo.height-83;for(this.botons=[],this.skip_animation||await this.esperar_evento(u);this.dialogo_data[this.nombre_dialogo].opciones&&this.dialogo_data[this.nombre_dialogo]["opcion_"+String(t+1)]!=null&&(this.botons[t]=new D(this,s,i,this.assets_data.get_boton_dialogo(),this.dialogo_data[this.nombre_dialogo]["opcion_"+String(t+1)],this.dialogo_data[this.nombre_dialogo]["texto_"+String(t+1)],this.skip_animation),t++,t!=3);)i-=this.botons[t-1].height,this.skip_animation||await this.esperar_evento(u);this.botons.length==0?setTimeout(()=>{this.texto_finalizado=!0},100):this.texto_finalizado=!0,this.skip_animation||await this.esperar_evento(u);for(let e=0;e<this.botons.length;e++)this.botons[e].can_be_clicked=!0}esperar_evento(t){return new Promise(s=>{this.events.once(t,()=>{s()})})}on_click(){if(this.can_be_clicked)if(this.texto_finalizado&&!this.dialogo_data[this.nombre_dialogo].opciones){if(this.dialogo_data[this.nombre_dialogo].opcion_1=="FIN"){this.scene.get(l).events.emit(S,this.dialogo_data[this.nombre_dialogo].texto_1);return}this.events.emit(A,this.dialogo_data[this.nombre_dialogo].opcion_1)}else this.cuadro_dialogo.texto_finnished?this.botons.length>0&&!this.botons[this.botons.length-1].texto_finnished&&(this.botons[this.botons.length-1].texto_finnished=!0,this.skip_animation=!0,this.events.emit(p)):(this.skip_animation=!0,this.events.emit(p))}on_next_dialogo_text(t){for(let i=0;i<this.botons.length;i++)this.botons[i].destroy();this.skip_animation=!1,this.nombre_dialogo=t,this.texto_finalizado=!1,this.background.change_texture(this.assets_data.get_background_dialogos(this.dialogo_data[this.nombre_dialogo].fondo)),this.cuadro_dialogo.actualizar_texto(this.dialogo_data[this.nombre_dialogo].texto),this.añadir_botones();let s=this.assets_data.get_personaje_dialogos(this.dialogo_data[this.nombre_dialogo].npc,this.dialogo_data[this.nombre_dialogo].pose);this.personaje.change_texture(s)}}class C extends Phaser.Scene{constructor(){super({key:R,active:!0})}preload(){setTimeout(()=>{this.scene_play()},500)}scene_play(){this.scene.start(P),this.scene.stop(R)}}class k extends Phaser.GameObjects.Sprite{constructor(t,s,i,e,a){super(t,s,i,e),this.assets_data=a,this.setOrigin(.5,.5),this.alpha=0,this.scene.add.existing(this),this.text=this.scene.add.text(this.x,this.y,"",{fontSize:"24px",fill:"#000000",align:"center"}).setOrigin(.5,.5),this.text.setVisible(!1),this.scene.input.on("pointermove",this.followPointer,this)}followPointer(t){this.x=t.worldX+this.width/4,this.y=t.worldY+100,this.text.setPosition(this.x,this.y)}change_cursor(t){switch(t){case"normal":this.change_img_cursor(this.assets_data.get_cursor());break;case"selected":this.change_img_cursor(this.assets_data.get_cursor_selected());break;case"left":this.change_img_cursor(this.assets_data.get_cursor_left());break;case"right":this.change_img_cursor(this.assets_data.get_cursor_right());break;default:console.error("Tipo de cursor no encontrado")}}change_img_cursor(t){const s=this.scene.textures.get(t);if(s){const i=s.getSourceImage().src;this.scene.input.setDefaultCursor(`url(${i}), pointer`)}else console.error(`Textura ${t} no encontrada`)}show_background_cursor(t,s){t?(this.alpha=1,this.showText(s)):(this.alpha=0,this.hideText())}showText(t){this.text.setText(t),this.text.setVisible(!0)}hideText(){this.text.setVisible(!1)}}class M extends Phaser.Scene{constructor(){super({key:l}),this.assets_data=new O(this)}init(){this.assets_data.recargar_datos()}preload(){this.assets_data.cargar_img_cursor(),setTimeout(()=>{this.change_cursor("normal")},1e3)}create(){this.cursor=new k(this,400,300,this.assets_data.get_background_cursor(),this.assets_data),this.events.on(I,this.start_dialogo,this),this.events.on(S,this.start_pantalla,this)}start_dialogo(t){this.stop_scenes(),this.scene.launch(m,t)}start_pantalla(t){this.stop_scenes(),this.scene.launch(g,t)}stop_scenes(){this.change_cursor("normal"),this.show_background_cursor(!1),this.scene.isActive(g)&&this.scene.stop(g),this.scene.isActive(m)&&this.scene.stop(m)}change_cursor(t){this.cursor.change_cursor(t)}show_background_cursor(t,s){this.cursor.show_background_cursor(t,s)}}class j extends Phaser.Scene{constructor(){super({key:P}),this.assets_data=new O(this)}preload(){this.assets_data.cargar_datos(),this.events.once(N,()=>{this.assets_data.cargar_dialogos(),this.assets_data.cargar_pantallas()}),this.scene.get(g).events.on(I,this.start_dialogo,this)}create(){this.scene.launch(l),this.pantallas=this.scene.start(g,"demo_habitacion_1")}start_dialogo(t){this.scene.launch(m,t)}}class X extends Phaser.GameObjects.Sprite{constructor(t,s,i,e){super(t,s,i,""),this.add_personaje(t,e)}change_texture(t){this.setTexture(t)}add_personaje(t,s){this.change_texture(s),this.setOrigin(.5,.5),t.add.existing(this)}}class U{constructor(t){this.animation_data={},this.TYPE="type",this.FADE_IN="fade_in",this.FADE_OUT="fade_out",this.DURATION="duration",this.ALPHA="alpha",this.ALPHA_ORIGINAL="alpha_original",this.SCALE="scale",this.SCALE_ORIGINAL="scale_original",this.POS_X="pos_x",this.POS_X_ORIGINAL="pos_x_original",this.POS_Y="pos_y",this.POS_Y_ORIGINAL="pos_y_original",this.set_data(t)}set_data(t){this.animation_data[this.DURATION]=t[this.DURATION],this.animation_data[this.ALPHA]=t[this.ALPHA],this.animation_data[this.ALPHA_ORIGINAL]=t[this.ALPHA],this.animation_data[this.SCALE]=t[this.SCALE],this.animation_data[this.SCALE_ORIGINAL]=t[this.SCALE],this.animation_data[this.POS_X]=t[this.POS_X],this.animation_data[this.POS_X_ORIGINAL]=t[this.POS_X],this.animation_data[this.POS_Y]=t[this.POS_Y],this.animation_data[this.POS_Y_ORIGINAL]=t[this.POS_Y]}get_animation_data(t){switch(t[this.TYPE]){case this.FADE_IN:this.fade_in(t);break;case this.FADE_OUT:this.fade_out(t);break;default:console.error("Tipo de animación no encontrado")}return this.animation_data}fade_in(t){this.animation_data[this.DURATION]=t[this.DURATION],this.animation_data[this.ALPHA]=1,this.animation_data[this.ALPHA_ORIGINAL]=0}fade_out(t){this.animation_data[this.DURATION]=t[this.DURATION],this.animation_data[this.ALPHA]=0,this.animation_data[this.ALPHA_ORIGINAL]=1}}class G extends Phaser.GameObjects.Sprite{constructor(t,s,i,e,a,h,o,_,r,c){super(t,s,i,e),this.name=e,this.nombre=c,this.setInteractive(),_&&(this.set_events(),this.on_click=_),this.setScale(a,h);let d={alpha:this.alpha,scale:this.scale,pos_x:this.x,pos_y:this.y};this.animation_data=new U(d),setTimeout(()=>{this.scene.add.existing(this),r?this.start_animation(r):this.scene.events.emit(f,this)},o),this.on("destroy",this.beforeDestroy,this)}start_animation(t){let s=this.animation_data.get_animation_data(t,this.info_data);this.alpha=s.alpha_original,this.scale=s.scale_original,this.x=s.pos_x_original,this.y=s.pos_y_original,this.scene.tweens.add({targets:this,duration:s.duration,alpha:s.alpha,scale:s.scale,x:s.pos_x,y:s.pos_y,ease:"Power2",onComplete:()=>{this.scene.events.emit(f,this)}})}set_events(){this.on("pointerover",()=>{this.mouse_entered()}),this.on("pointerout",()=>{this.mouse_exited()})}mouse_entered(){if(!this.can_be_clicked)return;this.setTint(14477567);let t=this.scene.scene.get(l);t.change_cursor("selected"),t.show_background_cursor(!0,this.nombre)}mouse_exited(){this.clearTint();let t=this.scene.scene.get(l);t.change_cursor("normal"),t.show_background_cursor(!1)}beforeDestroy(){}}class x extends G{constructor(t,s,i,e,a,h,o,_,r){super(t,s,i,e,a,a,h,o,_,r),this.can_be_clicked=!0}set_events(){super.set_events(),this.on("pointerdown",()=>{if(!this.can_be_clicked)return;let t=I;this.on_click.scene==="pantalla"&&(t=S),this.scene.scene.get(l).events.emit(t,this.on_click.name)})}}class F extends G{constructor(t,s,i,e,a,h,o){let _=new O(t);_.recargar_datos(),super(t,s,i,_.get_collider(),e,a,0,h,null),this.nombre=o,this.can_be_clicked=h.active}set_events(){super.set_events(),this.on("pointerdown",()=>{this.can_be_clicked&&this.scene.scene.get(l).events.emit(S,this.on_click.name)})}mouse_entered(){let t=this.scene.scene.get(l);t.change_cursor(this.on_click.direction),t.show_background_cursor(!0,this.nombre)}mouse_exited(){let t=this.scene.scene.get(l);t.change_cursor("normal"),t.show_background_cursor(!1)}}class J extends Phaser.Scene{constructor(){super({key:g}),this.assets_data=new O(this)}preload(){this.assets_data.cargar_backgrounds_pantallas(),this.assets_data.cargar_personajes_dialogos(),this.assets_data.cargar_img_collider()}init(t){this.assets_data.recargar_datos(),this.scene_play,this.offset_x=0,this.offset_y=0,this.can_move=!1,this.animation_finnished=!1,this.interactuables_animations={},this.nombre_pantalla=t,this.pantalla_data=this.cache.json.get(this.assets_data.get_json_pantalla()).Pantallas}create(){this.backgrounds_pantallas=this.create_backgrounds(),this.protagonista=this.create_protgonista(),this.npcs=this.create_npcs(),this.change_pantallas_oibjects=this.create_change_pantalla_objects(),this.input.on("pointermove",this.onPointerMove,this),this.events.on(f,this.on_animation_finnished,this)}create_backgrounds(){let t=this.pantalla_data[this.nombre_pantalla].background;return new X(this,this.sys.game.config.width/2,this.sys.game.config.height/2,this.assets_data.get_background_pantallas(t))}create_protgonista(){if(!this.pantalla_data[this.nombre_pantalla].prota)return;let t=this.pantalla_data[this.nombre_pantalla].prota.nombre,s=this.pantalla_data[this.nombre_pantalla].prota.pose,i=this.pantalla_data[this.nombre_pantalla].prota.pos_x,e=this.pantalla_data[this.nombre_pantalla].prota.pos_y,a=this.pantalla_data[this.nombre_pantalla].prota.size,h=this.pantalla_data[this.nombre_pantalla].prota.on_click,o=this.pantalla_data[this.nombre_pantalla].prota.delay,_=this.pantalla_data[this.nombre_pantalla].prota.animation,r=this.assets_data.get_personaje_dialogos(t,s),c=new x(this,i,e,r,a,o,h,_,t);return this.interactuables_animations[r]=!1,c}create_npcs(){let t=this.pantalla_data[this.nombre_pantalla].npcs,s=[];return Object.keys(t).forEach(i=>{let e=t[i].nombre,a=t[i].pose,h=t[i].pos_x,o=t[i].pos_y,_=t[i].size,r=t[i].on_click,c=t[i].delay,d=t[i].animation,b=this.assets_data.get_personaje_dialogos(e,a),T=new x(this,h,o,b,_,c,r,d,e);this.interactuables_animations[b]=!1,s.push(T)}),s}create_change_pantalla_objects(){let t=this.pantalla_data[this.nombre_pantalla].change_pantallas_objects,s=[];return Object.keys(t).forEach(i=>{let e=t[i].pos_x,a=t[i].pos_y,h=t[i].size_x,o=t[i].size_y,_=t[i].on_click,r=t[i].nombre,c=new F(this,e,a,h,o,_,r);s.push(c)}),s}update(){if(this.can_move&&this.animation_finnished){let t=0,s=0;Math.abs(this.movement_x+this.offset_x)<(this.backgrounds_pantallas.width-this.sys.game.config.width)/2&&(this.offset_x+=this.movement_x,t=this.movement_x),Math.abs(this.movement_y+this.offset_y)<(this.backgrounds_pantallas.height-this.sys.game.config.height)/2&&(this.offset_y+=this.movement_y,s=this.movement_y),this.move_objects(this.backgrounds_pantallas,t,s),this.move_objects(this.protagonista,t,s),this.npcs.forEach(i=>{this.move_objects(i,t,s)}),this.change_pantallas_oibjects.forEach(i=>{this.move_objects(i,t,s)})}}onPointerMove(t){let e=!0,a=!0;this.movement_x=0,this.movement_y=0,t.x<300?this.movement_x=1*(1-t.x/300):t.x>this.sys.game.config.width-300?this.movement_x=-1*(1-(this.sys.game.config.width-t.x)/300):(e=!1,this.movement_x=0),t.y<300?this.movement_y=1*(1-t.y/300):t.y>this.sys.game.config.height-300?this.movement_y=-1*(1-(this.sys.game.config.height-t.y)/300):(a=!1,this.movement_y=0),e||a?this.can_move=!0:this.can_move=!1}on_animation_start(t){this.animation_finnished=!1}on_animation_finnished(t){this.interactuables_animations[t.name]=!0;for(const s in this.interactuables_animations)if(!this.interactuables_animations[s])return;this.animation_finnished=!0}max_movement(){this.backgrounds_pantallas.x>0?this.backgrounds_pantallas.x=0:this.backgrounds_pantallas.x<this.sys.game.config.width-this.backgrounds_pantallas.width&&(this.backgrounds_pantallas.x=this.sys.game.config.width-this.backgrounds_pantallas.width),this.backgrounds_pantallas.y>0?this.backgrounds_pantallas.y=0:this.backgrounds_pantallas.y<this.sys.game.config.height-this.backgrounds_pantallas.height&&(this.backgrounds_pantallas.y=this.sys.game.config.height-this.backgrounds_pantallas.height)}move_objects(t,s,i){t.x+=s,t.y+=i}}const H={width:1860,height:1358,parent:"contenedor",physics:{default:"arcade"},scene:[C,j,v,J,M]};new Phaser.Game(H);
