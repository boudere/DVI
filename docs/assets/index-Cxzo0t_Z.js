import{getAuth as F,GoogleAuthProvider as $,signInWithPopup as K}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";import{initializeApp as q}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";import{getFirestore as Z,setDoc as B,doc as S,serverTimestamp as Q,getDoc as M,updateDoc as tt}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const d="DATA_INFO",y="PANTALLA_MANAGER",f="SCENE_MANAGER",v="DIALOGO_MANAGER",_="MINIJUEGO_MANAGER",A="CURSOR_MANAGER",G="AFINIDAD_DIALOGO_MANAGER",I="LOGIN_SCENE",U="JuegoOveja",z="JuegoDiscoteca",W="JuegoDucha",et="JuegoFruit",V="SIGNAL_SCENE_CREATED";class b extends Phaser.Scene{constructor(t){super(t),this.isPause=!1,this.animations_finished=0,this.total_animations=0,this.scene_name=t.key}exit(){this.pause()}enter(t){return!!t}_update(){this.isPause}pause(){this.isPause=!0}unpause(){this.isPause=!1}sendSignal(t){}onSignal(t){}scene_created(){this.scene.get(f).events.emit(V,this.scene.key)}starting_animation(){}cursor_entered(t,e){this.scene.get(f).cursor_entered(t,e)}cursor_exited(t){this.scene.get(f).cursor_exited(t)}move(t,e,s){}play_music(t,e={}){this.scene.get(f).play_music(this.scene_name,t,e)}stop_music(t,e){this.scene.get(f).stop_music(t,e)}play_sfx(t,e={}){this.scene.get(f).play_sound(this.scene_name,t,e)}stop_sfx(t,e){this.scene.get(f).stop_sound(t,e)}}class L extends Phaser.GameObjects.Sprite{constructor(t,e,s,i,a,n,o){super(t,e,s,i),this._reset_varaibles(),this.setScale(a,n),o&&(this._set_events(),this.on_click=o),this._set_main_events(),this.on("destroy",this.before_destroy,this)}_reset_varaibles(){this.isPause=!1,this.mouse_over=!1,this.game_object_data={}}_add_sprite(t){this.scene.add.existing(this),t?this.start_animation(t):this.finish_animation()}async start_animation(t){this.scene.starting_animation();let e=this.animation.get_animation_data(t,this.game_object_data);for(const[s,i]of Object.entries(e)){const a=i.map(n=>this.run_tween(n));await Promise.all(a)}this.finish_animation()}run_tween(t){"alpha_start"in t&&(this.alpha=t.alpha_start),"scaleX_start"in t&&(this.scale=t.scaleX_start),"scaleY_start"in t&&(this.scale=t.scaleY_start),"pos_x_start"in t&&(this.x=t.pos_x_start),"pos_y_start"in t&&(this.y=t.pos_y_start);const e={};return"alpha_end"in t&&(e.alpha=t.alpha_end),"scaleX_end"in t&&(e.scale=t.scaleX_end),"scaleY_end"in t&&(e.scale=t.scaleY_end),"pos_x_end"in t&&(e.x=t.pos_x_end),"pos_y_end"in t&&(e.y=t.pos_y_end),new Promise(s=>{this.scene.tweens.add({targets:this,duration:t.duration||500,ease:t.ease||"Power2",...e,onComplete:()=>s()})})}finish_animation(){}exit(){this.visible=!1,this._remove_events()}enter(){this.visible=!0}_update(){return!this.isPause}pause(){this.mouse_over&&this._mouse_out(),this.disableInteractive()}unpause(){this.setInteractive()}_start_animation(){}_stop_animation(){}_set_events(){this.on("pointerdown",this._mouse_down,this),this.on("pointerup",this._mouse_up,this),this.on("pointermove",this._mouse_move,this)}_remove_events(){this._remove_main_events(),this.off("pointerdown",this._mouse_down,this),this.off("pointerup",this._mouse_up,this),this.off("pointermove",this._mouse_move,this)}_set_main_events(){this.on("pointerover",this._mouse_over,this),this.on("pointerout",this._mouse_out,this),this.on("pointerupoutside",this._mouse_out,this)}_remove_main_events(){this.off("pointerover",this._mouse_over,this),this.off("pointerout",this._mouse_out,this),this.off("pointerupoutside",this._mouse_out,this)}_mouse_enter(){return!this.isPause}_mouse_over(){let t=!1;return this.on_click&&(t=!0),this.nombre&&this.scene.cursor_entered(this.nombre,t),!t||this.isPause?!1:(this.mouse_over=!0,this.setTint(14477567),!0)}_mouse_out(){return this.isPause?!1:(this.mouse_over=!1,this.clearTint(),this.nombre&&this.scene.cursor_exited(this.nombre),!0)}_mouse_down(){return!this.isPause}_mouse_up(){return!this.isPause}_mouse_move(){return!this.isPause}before_destroy(){}}class w extends L{constructor(t,e,s,i,a){super(t,e,s,i,1,1),this.delay=a}_reset_varaibles(){super._reset_varaibles()}finish_animation(){}exit(){this.musica.stop(),super.exit()}enter(){super.enter(),setTimeout(()=>{this._add_sprite(this.animation_data)},this.delay)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}_start_animation(){super._start_animation()}_stop_animation(){super._stop_animation()}_set_events(){super._set_events()}_remove_events(){super._remove_events()}_mouse_enter(){super._mouse_enter()}_mouse_over(){super._mouse_over()}_mouse_out(){super._mouse_out()}_mouse_down(){super._mouse_down()}_mouse_up(){super._mouse_up(),this.scene.signal_click(this.on_click)}_mouse_move(){super._mouse_move()}before_destroy(){super.before_destroy()}}class st extends Phaser.GameObjects.Text{constructor(t,e,s,i,a,n,o,h={}){let l={...{fontSize:"40px",fontFamily:"Times New Roman",color:"#000000",align:"left",lineSpacing:10,wordWrap:{width:a-20}},...h};super(t,e,s,"",l),this._reset_variables(),this.texto=n,this.containter=i,this.setOrigin(0,0),this.setDepth(i.depth+1),this.on("destroy",this.before_destroy,this),setTimeout(()=>{this._add_text(!0)},o)}_reset_variables(){this.isPause=!1}_add_text(t){this.scene.add.existing(this),t?this.start_animation():this.finish_animation()}start_animation(){let t=0,e=this.texto,s="";this.setText(""),this.scene.time.addEvent({delay:30,callback:()=>{s+=e.charAt(t),this.setText(s),t++,t>=e.length&&this.containter.finish_animation()},repeat:e.length-1})}run_tween(t){}finish_animation(){}exit(){this.visible=!1}enter(){this.visible=!0}_update(){return!this.isPause}pause(){this.mouse_over&&this._mouse_out(),this.disableInteractive()}unpause(){this.setInteractive()}_start_animation(){this.scene.start_animation()}_stop_animation(){}_set_events(){}before_destroy(){}}class D extends st{constructor(t,e,s,i,a,n,o,h={}){super(t,e,s,i,a,n,o,h)}}class O{constructor(t){this.animation={},this.DURATION="duration",this.data_json=t.scene.get(d).get_data_json().Json,this.animation_data=t.scene.get(d).get_json(this.data_json.Animation)}get_animation_data(t,e){let s={};return Object.entries(e).forEach(([i,a])=>{s[i]=a}),Object.entries(t).forEach(([i,a])=>{this.animation[i]=[],Object.entries(s).forEach(([n,o])=>{e[n]=s[n]}),a.forEach(n=>{this.animation[i].push({});let o=this.animation[i].length-1;this.get_animation(s,t,i,o,e)})}),this.animation}get_animation(t,e,s,i,a){let n=this.animation_data[e[s][i].type];this.animation[s][i][this.DURATION]=e[s][i][this.DURATION],Object.entries(n).forEach(([o,h])=>{let c=this.translate_animation(h,s,i,e,a);this.animation[s][i][o]=c,this.animation[s][i][o]=c,o.endsWith("_end")&&(t[o.slice(0,-4)]=c)})}translate_animation(t,e,s,i,a){if(typeof t!="string")return t;const n=[];let o="",h=0,c="";for(;h<t.length;){let p=t[h];if(/\d/.test(p)){const{result:u,nextIndex:m}=this.readWhile(t,h,/\d/);n.push(parseInt(u)),h=m;continue}if(p==="{"){const{result:u,nextIndex:m}=this.readBetween(t,h+1,"}");c=u,h=m;continue}if(p==="["){const{result:u,nextIndex:m}=this.readBetween(t,h+1,"]");n.push({bracketsContent:u}),h=m;continue}if(p==="$"){const{result:u,nextIndex:m}=this.readWhile(t,h+1,/[^\s\{\}\[\]\$]/);n.push({variable:u}),h=m;continue}h++}o.trim()&&n.push(o.trim());let l=[];return n.forEach(p=>{if(Number.isInteger(p))l.push(p);else if(p.variable){let u=p.variable.split("_");u.pop(),u=u.join("_"),l.push(a[u])}else p.bracketsContent&&l.push(i[e][s].var[p.bracketsContent])}),l.length<2?l[0]:this.operation_animation(l[0],l[1],c)}readBetween(t,e,s){let i="",a=e;for(;a<t.length&&t[a]!==s;)i+=t[a],a++;return{result:i,nextIndex:a+1}}readWhile(t,e,s){let i="",a=e;for(;a<t.length&&s.test(t[a]);)i+=t[a],a++;return{result:i,nextIndex:a}}operation_animation(t,e,s){switch(s){case"add":return t+e;case"sub":return t-e;case"mul":return t*e;case"div":return t/e;default:console.log("No se ha encontrado la operacion: "+s);break}}}class it extends w{constructor(t,e,s,i,a,n){super(t,e,s,i,200),this.SCALE=1.2,this.text=a,this.finished_animation=0,this.total_animations=0,this.game_object_data={alpha:this.alpha,scale:this.scale,pos_x:this.x,pos_y:this.y},n?(this.animation_data={animation_1:[{type:"fade_in",duration:400},{type:"scale_center",duration:400,var:{scale:this.SCALE}}]},this.animation=new O(this.scene,this.animation_data,1e3)):this.setScale(SCALE)}create(){this.on("destroy",this.before_destroy,this)}finish_animation(){if(this.total_animations==0){this._load_main_text();return}this.finished_animation++,this.finished_animation==this.total_animations&&this.scene.finish_animation()}setText(t){this.total_animations=0,this.finished_animation=0,this.text=t,this._load_main_text()}_load_main_text(){this.main_text&&this.main_text.destroy();let t=this.x-this.width/2-110,e=this.y-this.height/2+25;this.main_text=new D(this.scene,t,e,this,this.width*1.2,this.text,this.delay).setOrigin(0,0),this.total_animations++}before_destroy(){this.main_text&&this.main_text.destroy(),super.before_destroy()}}class at extends w{constructor(t,e,s,i,a,n,o,h){super(t,e,s,i,200),this.setOrigin(1,1),this.SCALE=1.2,this.text=a,this.next_text=n,this.finished_animation=0,this.total_animations=0,this.animation_finished=!1,this.game_object_data={alpha:this.alpha,scale:this.scale,pos_x:this.x,pos_y:this.y},this.on_click={scene:"dialogo",name:this.next_text,var_id:h},o?(this.animation_data={animation_1:[{type:"fade_in",duration:200},{type:"scale_up",duration:200,var:{scaleX:this.SCALE,scaleY:this.SCALE}}]},this.animation=new O(this.scene,this.animation_data,1e3)):this.setScale(this.SCALE)}finish_animation(){if(this.total_animations==0){this._load_main_text();return}this.finished_animation++,this.finished_animation==this.total_animations&&(this.finished_animation=0,this.animation_finished=!0,this.scene.finish_animation())}setText(t){this.total_animations=0,this.finished_animation=0,this.text=t,this._load_main_text()}_load_main_text(){this.main_text&&this.main_text.destroy();let t=this.x-this.width/2-100,e=this.y-this.height/2;this.main_text=new D(this.scene,t-this.width/2,e-this.height/3,this,this.width*this.SCALE,this.text,this.delay,!this.animation_finished,{fontSize:"32px"}).setOrigin(0,0),this.total_animations++}before_destroy(){super.before_destroy(),this.main_text&&this.main_text.destroy()}pause(){super.pause(),this._remove_events()}unpause(){super.unpause(),this._set_events()}_mouse_up(){super._mouse_up()}}class nt extends w{constructor(t,e,s,i,a){super(t,e,s,i,a),this.finished_animation=0,this.total_animations=0,this.game_object_data={alpha:this.alpha,scaleX:this.scaleX,scaleY:this.scaleY,pos_x:this.x,pos_y:this.y},this.animation_data={animation_1:[{type:"fade_in",duration:400},{type:"move_right",duration:400,var:{pos_x:500}}]},this.animation=new O(this.scene,this.animation_data,1e3),this.total_animations++}finish_animation(){this.finished_animation++,this.finished_animation==this.total_animations&&(this.finished_animation=0,this.scene.finish_animation())}}class ot extends b{constructor(){super({key:v}),this.CUADRADO_DIALOGO="cuadrado_dialogo",this.BUTTON_CUADRADO_DIALOGO="boton_dialogo",this.BACKGROUND_DEPTH=0,this.PERSONAJE_DEPTH=1,this.CUADRADO_DIALOGO_DEPTH=3,this.PISO_MUSICA="tema_inicial"}_reset_data(){this.cuadrado_dialogo=null,this.main_text=null,this.dialogo_data_selected=null,this.npc="",this.buttons_index=0,this.buttons=[]}create(){this.data_info_scene=this.scene.get(d),this.dialogo_data=this.data_info_scene.get_json(this.data_info_scene.data_json.Dialogos),this.opciones_dialogo_data=this.data_info_scene.get_json(this.data_info_scene.data_json.OpcionesDialogo),this.variables_dialogo_data=this.data_info_scene.get_json(this.data_info_scene.data_json.VariablesDialogo),this.scene_created()}_load_dialogo(t){const{width:e,height:s}=this.sys.game.canvas;this.animation_finished=!1,this.animate?this._load_cuadrado_dialogo(e,s):(this.cuadrado_dialogo&&(this.cuadrado_dialogo.visible=!0),this._set_main_text()),this.total_animations++,this._load_background(),this.animate?(this._load_personaje(e,s),this.total_animations++):this.persoanje&&(this.persoanje.visible=!0),this.buttons&&this.buttons.forEach(i=>i.destroy()),this.dialogo_data_selected.opciones&&this._load_buttons(e,s)}exit(){super.exit(),this.cuadrado_dialogo&&(this.cuadrado_dialogo.visible=!1,this.cuadrado_dialogo.main_text.visible=!1),this.persoanje&&(this.persoanje.visible=!1),this.background&&(this.background.visible=!1),this._remove_events()}enter(t){let e=null;t.name?e=t.name:e=t,super.enter(e)&&(this.play_music(this.PISO_MUSICA),this.dialogo_data_selected=this.dialogo_data[e],this.opciones_dialogo_data_selected=null,this.dialogo_data_selected&&this.dialogo_data_selected.opciones&&(this.opciones_dialogo_data_selected=this.opciones_dialogo_data[this.dialogo_data_selected.next_id]),this.animate=this.dialogo_data_selected.npc!=this.npc,this.npc=this.dialogo_data_selected.npc,this.total_animations=0,this.finished_animation=0,this.buttons_index=0,this._load_dialogo(e),this.background.visible=!0,this.animate&&this.persoanje&&this.persoanje.enter(),this._set_events(),this.pause())}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}starting_animation(){this.animation_finished=!1,this.pause()}finish_animation(){if(this.finished_animation++,this.finished_animation==1&&this.animate){this.cuadrado_dialogo.enter();return}if(this.dialogo_data_selected.opciones&&this.buttons_index<this.buttons.length){this.buttons[this.buttons_index].enter(),this.buttons_index++;return}this.finished_animation==this.total_animations&&(this.animation_finished=!0,this.dialogo_data_selected.opciones&&this.buttons.forEach(t=>t.unpause()),this.unpause())}signal_click(t){t.var_id||t.scene!="dialogo"?(t.var_id&&(t.scene="afinidad_dialogo"),this.scene.get(f).signal_click(t)):this.enter(t)}_load_background(){this.background&&this.background.destroy();let t=this.data_info_scene.get_img(v,this.dialogo_data_selected.fondo);this.background=this.add.image(0,0,t).setOrigin(0,0),this.background.setDepth(this.BACKGROUND_DEPTH);let e=this.scale.height,s=this.background.height,i=e/s;this.background.setScale(i)}_load_cuadrado_dialogo(t,e,s=!0){this.cuadrado_dialogo&&this.cuadrado_dialogo.destroy();let i=this.data_info_scene.get_img(v,this.CUADRADO_DIALOGO);this.cuadrado_dialogo=new it(this,t/2,e-150,i,this.dialogo_data_selected.texto,s),this.cuadrado_dialogo.setDepth(this.CUADRADO_DIALOGO_DEPTH)}_set_main_text(){this.cuadrado_dialogo.setText(this.dialogo_data_selected.texto)}_load_personaje(t,e){this.persoanje&&this.persoanje.destroy();let s=this.dialogo_data_selected.npc+"_"+this.dialogo_data_selected.pose,i=this.data_info_scene.get_img(v,s);this.persoanje=new nt(this,0,e*.64,i,1e3),this.persoanje.setDepth(this.PERSONAJE_DEPTH)}_load_nombre_personaje(){this.dialogo_data_selected.personaje!="none"}_load_buttons(t,e){this.buttons=[];let s=this.data_info_scene.get_img(v,this.BUTTON_CUADRADO_DIALOGO),i=this.cuadrado_dialogo.x+this.cuadrado_dialogo.width/2*this.cuadrado_dialogo.SCALE,a=this.cuadrado_dialogo.y-this.cuadrado_dialogo.height/2*this.cuadrado_dialogo.SCALE;for(this.buttons_index=1;this.buttons_index<=4&&this.opciones_dialogo_data_selected["texto_"+this.buttons_index];){let n=new at(this,i,a,s,this.opciones_dialogo_data_selected["texto_"+this.buttons_index],this.opciones_dialogo_data_selected["opcion_"+this.buttons_index],!0);n.setDepth(this.CUADRADO_DIALOGO_DEPTH+1),this.buttons_index++,a-=n.height,this.buttons.push(n),this.total_animations++}this.buttons_index=0}_set_events(){this.input.on("pointerup",this._mouse_up,this)}_remove_events(){this.input.off("pointerup",this._mouse_up,this)}_mouse_up(){if(this.animation_finished&&!this.dialogo_data_selected.opciones)if(this.dialogo_data_selected.next_id!="FIN"&&!this.dialogo_data_selected.opciones)this.enter(this.dialogo_data_selected.next_id);else{let t={scene:this.dialogo_data_selected.next_scene_type,name:this.dialogo_data_selected.next_scene_id,var_id:this.dialogo_data_selected.var_id};this.scene.get(f).signal_click(t)}}}class rt extends L{constructor(t,e,s,i){super(t,e,s,i,1,1),this.scene.add.existing(this),this.create()}create(){this.name_text=new D(this.scene,this.x,this.y,this,this.width," ",0,{fontSize:"24px",align:"center"}).setOrigin(.5,.5),this.exit()}exit(){super.exit(),this.visible=!1,this.name_text.visible=!1,this.clearTint()}enter(t,e){super.enter(),this.visible=!0,this.name_text.visible=!0,this.name_text.setText(t),e||this.setTint(8947848)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}finish_animation(){}move(t,e){e+=this.height*2,this.x=t,this.y=e,this.name_text.x=t,this.name_text.y=e}}class ht extends b{constructor(){super({key:A})}_reset_data(){}create(){this.scene_manager=this.scene.get(f),this._set_events(),this.movement_x=0,this.movement_y=0,this.can_move=!1,this.background=new rt(this,0,0,this.scene.get(d).get_img(A,"can_be_clicked")),this._set_events()}enter(t){this.edge_margin=t.edge_margin,this.move_speed=t.move_speed}_update(t,e){this.can_move&&this.scene_manager.move(this.movement_x*e,this.movement_y*e)}_set_events(){this.input.on("pointermove",this._mouse_move,this),this.input.on("pointerup",this._mouse_up,this)}_mouse_move(t){this.background.move(t.x,t.y);const e=this.edge_margin,s=this.move_speed;if(this.movement_x=0,this.movement_y=0,t.x<e){const i=(e-t.x)/e;this.movement_x=s*i}else if(t.x>this.sys.game.config.width-e){const i=(t.x-(this.sys.game.config.width-e))/e;this.movement_x=-s*i}if(t.y<e){const i=(e-t.y)/e;this.movement_y=s*i}else if(t.y>this.sys.game.config.height-e){const i=(t.y-(this.sys.game.config.height-e))/e;this.movement_y=-s*i}this.can_move=this.movement_x!==0||this.movement_y!==0}_mouse_up(){this.background.exit()}_load_background(){}cursor_entered(t,e){this.background.enter(t,e)}cursor_exited(t){this.background.exit(t)}}class T extends Phaser.Scene{constructor(t){super(t)}_update(t,e){}enter(){}exit(){}_set_event(t){}_remove_event(t){}game_created(){this.scene.get(_).game_created(this.scene.key)}start_game(){}finnish_game(){}}class g extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s,i){let a=t.scene.get(d).get_img(_,i);super(t,e,s,a),this._add_img(),this._set_colliders(),this.visible=!1}enter(){this.visible=!0}exit(){this.destroy()}_update(t,e){}_set_event(t){}_remove_event(t){}_set_colliders(t=.8,e=.8){let s=this.width*t,i=this.height*e,a=this.width*(1-t)/2,n=this.height*(1-e)/2;this.body.setSize(s,i),this.body.setOffset(a,n)}_add_img(){this.scene.add.existing(this),this.scene.physics.add.existing(this)}}class _t extends g{constructor(t,e,s){super(t,e,s,"oveja")}enter(){super.enter(),setTimeout(()=>{this.setBounce(0),this.set_gravity_force(800),this.setVelocityX(-500)},10),this._set_colliders(.7,.7)}exit(){super.exit()}set_gravity_force(t){this.body.setGravityY(t)}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class lt extends g{constructor(t,e,s){super(t,e,s,"valla"),this.body.setAllowGravity(!1)}enter(){super.enter(),this._set_colliders(.45,.65)}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class ct extends g{constructor(t,e,s){super(t,e,s,"suelo"),this.setScale(1,1),this.setImmovable(!0),this.body.setAllowGravity(!1)}enter(){super.enter()}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=1,e=.15){super._set_colliders(t,e)}}class ut extends g{constructor(t,e,s){super(t,e,s,"cielo"),this.body.setAllowGravity(!1)}enter(){super.enter()}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}}class dt extends g{constructor(t,e,s,i,a=null){let n="nube",o={cerca:{x:0,y:.35,nubes:[3,5],velocity:100},media:{x:0,y:.18,nubes:[1,2],velocity:80},lejos:{x:0,y:.08,nubes:[1,2,4],velocity:50}};a=a||Phaser.Math.RND.pick(o[i].nubes),n+=a,super(t,e,s*o[i].y,n),this.data_info=o,this.distancia=i,this.body.setAllowGravity(!1)}enter(){super.enter(),this.setVelocityX(this.data_info[this.distancia].velocity*-1)}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}}class pt extends g{constructor(t,e,s){let i="prota1";super(t,e,s,i),this.PROTA_IMG=i,this.PROTA_IMG_2="prota2",this.body.setAllowGravity(!1),this.puntuacion=0}oveja_contada(t){let e=this.scene.data_info_scene.get_img(_,this.PROTA_IMG_2);this.setTexture(e),this.puntuacion=t,this.add_text(),setTimeout(()=>{t==this.puntuacion&&(e=this.scene.data_info_scene.get_img(_,this.PROTA_IMG),this.setTexture(e),this.destroy_text())},400)}add_text(){let t=this.x+28;this.puntuacion>10?t=this.x+25:this.puntuacion>100&&(t=this.x+20),this.texto=this.scene.add.text(t,this.y-80,`${this.puntuacion}`,{fontSize:"32px",fill:"#000000",fontFamily:"Impact"}).setOrigin(.5,.5),this.texto.setDepth(1)}destroy_text(){this.texto&&this.texto.destroy()}enter(){super.enter()}exit(){this.texto&&this.texto.destroy(),super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}}class Y extends Phaser.GameObjects.Sprite{constructor(t,e,s,i){super(t,e,s,i),this.setOrigin(0,0),this.setScale(t.scale.width/this.width,t.scale.height/this.height),this.setInteractive(),this.total_clicks=0,this.clicks=0}enter(t=null){this.scene.add.existing(this),this.total_clicks++,this._set_events()}exit(){this._remove_events(),this.destroy()}next_frame(){this.clicks++,this.clicks>=this.total_clicks&&(this.clicks=0,this.action())}action(){}_set_events(){this.on("pointerup",this._mouse_up,this)}_remove_events(){this.off("pointerup",this._mouse_up,this)}_mouse_up(){this.next_frame()}}class P extends Y{constructor(t,e,s,i){super(t,e,s,i)}action(){this.scene.start_game()}}let ft=class extends P{constructor(t,e,s,i){super(t,e,s,i)}};class N extends Y{constructor(t,e,s,i){super(t,e,s,i)}action(){this.scene.finnish_game()}}let mt=class extends N{constructor(t,e,s,i){super(t,e,s,i)}};class gt extends T{constructor(t){super({key:U}),t={PANTALLA_INICIO:"pantalla_inicio",PANTALLA_FINAL:"pantalla_final"},this.OVEJA_IMG=t.OVEJA_IMG,this.VALLA_IMG=t.VALLA_IMG,this.FONDO_IMG=t.FONDO_IMG,this.CIELO_IMG=t.CIELO_IMG,this.PANTALLA_INICIO=t.PANTALLA_INICIO,this.PANTALLA_FINAL=t.PANTALLA_FINAL,this.OVEJITA_MUSICA="ovejitas",this.started=!1,this.ovejas_contadas=0,this.oveja_contada=[]}create(){this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.data_info_scene=this.scene.get(d),this.persoanl_best=this.data_info_scene.get_json("saves").Minijuegos.JuegoOveja.RecortdPuntuacion,this.datos_usuario=this.data_info_scene.get_datos_usaurio().Minijuegos.JuegoOveja,this.persoanl_best=this.datos_usuario.RecortdPuntuacion,this.scene.get(_).play_music(this.OVEJITA_MUSICA),this.ovejas=[],this.nubes={cerca:[],media:[],lejos:[]},this.nubes_cantidad={cerca:0,max_cerca:2,media:0,max_media:1,lejos:0,max_lejos:2},this._crear_cielo(),this._crear_nubes_iniciales(),this._crear_suelo(),this._crear_prota(),this._crear_valla(),this._crear_marcador(),this._crear_pantalla_inicio(),this._crear_pantalla_final(),this.cursors=this.input.keyboard.createCursorKeys(),this.ovejaGroup=this.physics.add.group(),this.physics.add.collider(this.ovejaGroup,this.suelo),this.physics.add.collider(this.ovejaGroup,this.valla,(t,e)=>{this.choque_function(e)}),this.input.on("pointerdown",()=>{if(this.started)for(let t=0;t<this.ovejas.length;t++){const e=this.ovejas[t];if(e&&e.body&&e.body.onFloor()){e.setVelocityY(-1e3);break}}}),this.game_created()}enter(){super.enter(),this.pantalla_inicio.enter()}start_game(){this.pantalla_inicio.exit(),this.cielo.enter(),Object.keys(this.nubes).forEach(t=>{this.nubes[t].forEach(e=>{e.enter()})}),this.suelo.enter(),this.prota.enter(),this.valla.enter(),this._crear_oveja(),this.schedule_next_oveja(),this.schedule_next_nube(),this.started=!0}finnish_game(){this.pantalla_final.exit(),this.persoanl_best<this.ovejas_contadas&&this.data_info_scene.guardar_puntuacion(this.scene.key,this.ovejas_contadas),this.scene.get(_).return_to_dialogo()}_crear_cielo(){let t=0,e=0;this.cielo=new ut(this,t,e).setOrigin(0,0)}_crear_nubes_iniciales(){let t=["cerca","media","lejos"];this.nubes[t[0]].push(this._anadir_nube(t[0],100,5)),this.nubes[t[0]].push(this._anadir_nube(t[0],1400,3)),this.nubes[t[1]].push(this._anadir_nube(t[1],1200,1)),this.nubes[t[2]].push(this._anadir_nube(t[2],250,2)),this.nubes[t[2]].push(this._anadir_nube(t[2],900,4))}_crear_nubes(){let t=["cerca","media","lejos"];t=Phaser.Utils.Array.Shuffle(t),t.forEach(e=>{if(this.nubes[e].length<this.nubes_cantidad[`max_${e}`]){let s=this._anadir_nube(e);s.enter(),this.nubes[e].push(s);return}})}_anadir_nube(t,e=null,s=null){e=e||this.SCREEN_WIDTH;let i=this.SCREEN_HEIGHT;return new dt(this,e,i,t,s).setOrigin(0,0)}_crear_suelo(){let t=this.SCREEN_WIDTH/2,e=this.SCREEN_HEIGHT*.9;this.suelo=new ct(this,t,e)}_crear_oveja(){let t=this.SCREEN_WIDTH+100,e=this.SCREEN_HEIGHT*.78,s=new _t(this,t,e);s.enter(),this.ovejas.push(s),this.ovejaGroup.add(s)}_crear_prota(){let t=650,e=this.SCREEN_HEIGHT*.65;this.prota=new pt(this,t,e)}_crear_valla(){let t=500,e=this.SCREEN_HEIGHT*.88-100;this.valla=new lt(this,t,e)}_crear_pantalla_inicio(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_INICIO);this.pantalla_inicio=new ft(this,t,e,s)}_crear_pantalla_final(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_FINAL);this.pantalla_final=new mt(this,t,e,s)}_crear_marcador(){this.contadorTexto=this.add.text(this.SCREEN_WIDTH-50,50,`Ovejas: ${this.ovejas_contadas}`,{fontSize:"40px",fill:"#ffffff",fontFamily:"Impact"}).setOrigin(1,0).setDepth(1)}schedule_next_oveja(){let t=100,e=300;t=Math.max(500,1e3-this.ovejas_contadas*10),e=Math.max(1e3,1500-this.ovejas_contadas*20);const s=Phaser.Math.Between(t,e);this.time.delayedCall(s,()=>{this.started&&(this._crear_oveja(),this.schedule_next_oveja())})}schedule_next_nube(){let t=100,e=300;t=Math.max(100,300-this.ovejas_contadas*10),e=Math.max(400,500-this.ovejas_contadas*20);const s=Phaser.Math.Between(t,e);this.time.delayedCall(s,()=>{this.started&&(this._crear_nubes(),this.schedule_next_nube())})}_update(){this.started&&(this.ovejas_update(),this.nubes_update())}ovejas_update(){this.ovejas.forEach(t=>{t&&t.x<this.valla.x&&!t.contada&&(t.contada=!0,this.oveja_contada.push(this.ovejas.shift()))});for(let t=this.oveja_contada.length-1;t>=0;t--){const e=this.oveja_contada[t];if(e.x<-50){e.exit(),e.destroy(),this.oveja_contada.splice(t,1);continue}e.body&&this.valla.x-this.valla.displayWidth&&!e._yaSumada&&(e._yaSumada=!0,this.ovejas_contadas++,this.contadorTexto.setText(`Ovejas: ${this.ovejas_contadas}`),this.prota.oveja_contada(this.ovejas_contadas))}}nubes_update(){Object.keys(this.nubes).forEach(t=>{this.nubes[t].forEach(e=>{e.x<-e.displayWidth&&(e.exit(),e.destroy(),this.nubes[t].splice(this.nubes[t].indexOf(e),1))})})}choque_function(t){this.started=!1,t.setTint(16711680),this.physics.pause(),this.time.removeAllEvents(),this.scene.get(_).stop_music(this.OVEJITA_MUSICA);const e=this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Perdiste!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5).setDepth(1);setTimeout(()=>{this.pantalla_final.enter(this.vallasSaltadas),this.prota.exit(),Object.keys(this.nubes).forEach(s=>{this.nubes[s].forEach(i=>{i.exit()})}),this.valla.exit(),this.cielo.destroy(),this.ovejas.forEach(s=>{s.exit()}),this.oveja_contada.forEach(s=>{s.exit()}),this.ovejaGroup.clear(!0,!0),this.suelo.exit(),this.contadorTexto.destroy(),e.destroy()},2e3)}}class vt extends g{constructor(t,e,s,i,a){super(t,e,s,"persona"),this.setScale(i,a)}enter(){super.enter(),this.setGravityY(800),this.setBounce(0),this.setCollideWorldBounds(!0)}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}let xt=class extends g{constructor(t,e,s,i,a){super(t,e,s,"fondodisco"),this.setScale(i,a),this.body.setAllowGravity(!1)}enter(){super.enter()}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}},yt=class extends P{constructor(t,e,s,i){super(t,e,s,i)}},bt=class extends N{constructor(t,e,s,i){super(t,e,s,i)}};class At extends T{constructor(t){super({key:z}),t={PERSONA_IMG:"persona",OBSTACULO_IMG:"obstaculo",FONDO_IMG:"fondodisco",PANTALLA_INICIO:"pantalla_inicio_disco",PANTALLA_FINAL:"pantalla_final_disco"},this.PERSONA_IMG=t.PERSONA_IMG,this.OBSTACULO_IMG=t.OBSTACULO_IMG,this.FONDO_IMG=t.FONDO_IMG,this.PANTALLA_INICIO=t.PANTALLA_INICIO,this.PANTALLA_FINAL=t.PANTALLA_FINAL,this.DISCOTECA_MUSICA="disco",this.personawidth=408,this.personaheight=612,this.obstaculowidth=1024,this.obstaculoheight=1024,this.fondowidth=1536,this.fondoheight=1024,this.started=!1}create(){this.obstaculossaltados=0,this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.data_info_scene=this.scene.get(d),this.scene.get(_).play_music(this.DISCOTECA_MUSICA),this.obstaculos=[],this._crear_fondo(),this._crear_persona(),this._crear_marcador(),this._crear_pantalla_inicio(),this._crear_pantalla_final(),this.cursors=this.input.keyboard.createCursorKeys(),this.pointerDownEvent=this.input.on("pointerdown",()=>{!this.started||!this.persona||this.persona.setVelocityY(-600)}),this.game_created()}enter(){super.enter(),this.pantalla_inicio.enter()}start_game(){this.pantalla_inicio.exit(),this.fondo.enter(),this.persona.enter(),this._next_obstaculo(),this.started=!0}finnish_game(){this.pantalla_final.exit(),this._clean_up(),this.scene.get(_).return_to_dialogo()}_crear_marcador(){this.contadorTexto=this.add.text(this.SCREEN_WIDTH-50,50,`Puntuación: ${this.obstaculossaltados}`,{fontSize:"40px",fill:"#ffffff",fontFamily:"Impact"}).setOrigin(1,0).setDepth(1)}_crear_fondo(){let t=0,e=0,s=this.SCREEN_WIDTH/this.fondowidth,i=this.SCREEN_HEIGHT/this.fondoheight;this.fondo=new xt(this,t,e,s,i).setOrigin(0,0)}_crear_persona(){let t=175,e=this.SCREEN_HEIGHT*.5;this.persona=new vt(this,t,e,150/this.personawidth,150/this.personaheight)}_crear_pantalla_inicio(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_INICIO);this.pantalla_inicio=new yt(this,t,e,s)}_crear_pantalla_final(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_FINAL);this.pantalla_final=new bt(this,t,e,s)}_next_obstaculo(){const t=Phaser.Math.Between(1500,3e3);this.timerEvent=this.time.delayedCall(t,()=>{this._spawn_obstaculo(),this._next_obstaculo()})}_spawn_obstaculo(){let t=300,e=350,s=this.SCREEN_WIDTH+100,i=100,a=this.SCREEN_HEIGHT-t-100,n=Phaser.Math.Between(i,a),o=n-t/2,h=this.SCREEN_HEIGHT-(n+t/2),c=this.data_info_scene.get_img(_,this.OBSTACULO_IMG);this.tuboSuperior=this.physics.add.sprite(s,o/2,c).setScale(e/this.obstaculowidth,o/this.obstaculoheight),this.tuboSuperior.setFlipY(!0),this.tuboInferior=this.physics.add.sprite(s,n+t/2+h/2,c).setScale(e/this.obstaculowidth,h/this.obstaculoheight),[this.tuboSuperior,this.tuboInferior].forEach(l=>{l.setVelocityX(-500),l.setGravityY(-600),l.refreshBody()}),this.physics.add.collider(this.persona,this.tuboInferior,this._game_over,null,this),this.physics.add.collider(this.persona,this.tuboSuperior,this._game_over,null,this),this.obstaculos.push({superior:this.tuboSuperior,inferior:this.tuboInferior,contado:!1})}_game_over(){if(this.losing)return;this.losing=!0,this.persona.setTint(16711680),this.physics.pause(),this.time.removeAllEvents(),this.scene.get(_).stop_music(this.DISCOTECA_MUSICA);const t=this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Perdiste!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5).setDepth(1);setTimeout(()=>{this.pantalla_final.enter(),t.destroy()},2e3)}_update(){!this.started||!this.persona||(this.persona.body&&this.persona.body.blocked.down&&this.persona.setVelocityY(0),this.obstaculos.forEach(t=>{const e=t.inferior;e.x<this.persona.x&&!t.contado&&(this.obstaculossaltados++,this.contadorTexto.setText(`Puntuación: ${this.obstaculossaltados}`),t.contado=!0),e.x<-e.width&&(t.superior.destroy(),t.inferior.destroy())}))}_clean_up(){this.pointerDownEvent&&this.input.off("pointerdown"),this.time.removeAllEvents(),this.physics.pause(),this.persona&&this.persona.destroy(),this.fondo&&this.fondo.destroy(),this.contadorTexto&&this.contadorTexto.destroy(),this.obstaculos.forEach(t=>{t.superior&&t.superior.destroy(),t.inferior&&t.inferior.destroy()}),this.obstaculos=[]}}class Et extends g{constructor(t,e,s,i,a){super(t,e,s,"mampara"),this.setScale(i,a),this.body.setAllowGravity(!1)}enter(){super.enter()}exit(){super.exit()}_update(){super._update()}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}}class It extends g{constructor(t,e,s,i,a){super(t,e,s,"burbuja"),this.setScale(i,a),this.body.setAllowGravity(!1),this.body.setImmovable(!0),t.add.existing(this)}enter(){super.enter()}_update(){super._update()}exit(){super.exit()}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class St extends g{constructor(t,e,s,i,a){super(t,e,s,"gota"),this.scene=t,this.setScale(i,a)}enter(){super.enter()}_update(){this.active}exit(){super.exit()}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class Ot extends g{constructor(t,e,s,i,a){super(t,e,s,"barra"),this.setScale(i,a),this.setImmovable(!0),this.speed=600}enter(){super.enter(),this.setCollideWorldBounds(!0)}_update(){this.active&&(this.setVelocityX(0),this.cursors.left.isDown?this.setVelocityX(-this.speed):this.cursors.right.isDown&&this.setVelocityX(this.speed))}exit(){super.exit()}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}let Tt=class extends P{constructor(t,e,s,i){super(t,e,s,i)}},Pt=class extends N{constructor(t,e,s,i){super(t,e,s,i)}};class Nt extends T{constructor(t){super({key:W}),t={GOTA_IMG:"gota",BARRA_IMG:"barra",BURBUJA_IMG:"burbuja",MAMPARA_IMG:"mampara",PANTALLA_INICIO:"pantalla_inicio_ducha",PANTALLA_FINAL:"pantalla_final_ducha"},this.GOTA_IMG=t.GOTA_IMG,this.BARRA_IMG=t.BARRA_IMG,this.BURBUJA_IMG=t.BURBUJA_IMG,this.PANTALLA_INICIO=t.PANTALLA_INICIO,this.PANTALLA_FINAL=t.PANTALLA_FINAL,this.burbujas,this.mamparawidth=1536,this.mamparaheight=1024,this.SCORE=0,this.started=!1}create(){this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.data_info_scene=this.scene.get(d),this._crear_mampara(),this._crear_barra(),this._crear_gota(),this._crear_marcador(),this._crear_burbujas(),this._crear_pantalla_inicio(),this._crear_pantalla_final(),this.burbujas=[],this.physics.add.collider(this.gota,this.barra,this._rebote_barra,null,this),this.physics.add.collider(this.gota,this.burbujas,this._romper_burbuja,null,this),this.physics.world.on("worldbounds",(t,e,s)=>{t.gameObject===this.gota&&s&&this._reset_gota()}),this.started=!0,this.game_created()}enter(){super.enter(),this.pantalla_inicio.enter()}start_game(){this.pantalla_inicio.exit(),this.mampara.enter(),this.burbujas.forEach(t=>t.enter()),this.barra.enter(),this.gota.enter(),this._setup_input(),this.started=!0,this.time.delayedCall(1e4,()=>{this.started&&this._game_over()})}_crear_mampara(){const t=this.SCREEN_WIDTH/this.mamparawidth,e=this.SCREEN_HEIGHT/this.mamparaheight;this.mampara=new Et(this,0,0,t,e).setOrigin(0,0)}_crear_barra(){this.barra=new Ot(this,this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT-50,1.5,1.5),this.barra.body.allowGravity=!1}_crear_gota(){this.gota=new St(this,this.barra.x,this.barra.y-30,.2,.2),this.physics.add.existing(this.gota),this.gota.body.setMaxVelocity(700,800),this.gota.setBounce(5),this.gota.setCollideWorldBounds(!0),this.gota.body.onWorldBounds=!0,this.gota.setData("onBarra",!0),this.gota.body.allowGravity=!1,this.gota.setVelocity(0,0)}_crear_marcador(){this.scoreText=this.add.text(20,20,"Puntos: 0",{fontSize:"32px",fill:"#ffffff",fontFamily:"Impact"})}_crear_pantalla_inicio(){let t=this.data_info_scene.get_img(_,this.PANTALLA_INICIO);this.pantalla_inicio=new Tt(this,0,0,t)}_crear_pantalla_final(){let t=this.data_info_scene.get_img(_,this.PANTALLA_FINAL);this.pantalla_final=new Pt(this,0,0,t)}_crear_burbujas(){this.burbujas=this.physics.add.staticGroup();const t=5,e=7,s=120,i=100,a=60/256,n=(e-1)*s,o=(this.SCREEN_WIDTH-n)/2,h=this.SCREEN_HEIGHT*.1;for(let c=0;c<t;c++)for(let l=0;l<e;l++){const p=o+l*s,u=h+c*i,m=new It(this,p,u,a,a);this.burbujas.add(m)}}_setup_input(){this.input.on("pointermove",t=>{this.barra.x=Phaser.Math.Clamp(t.x,52,this.SCREEN_WIDTH-52),this.gota.getData("onBarra")&&(this.gota.x=this.barra.x)}),this.input.on("pointerup",()=>{this.gota.getData("onBarra")&&(this.gota.setVelocity(-75,-300),this.gota.setData("onBarra",!1))})}_rebote_barra(t,e){let s=0;t.x<e.x?(s=e.x-t.x,t.setVelocityX(-10*s)):t.x>e.x?(s=t.x-e.x,t.setVelocityX(10*s)):t.setVelocityX(2+Math.random()*8)}_romper_burbuja(t,e){e.disableBody(!0,!0),this.SCORE+=5,this.scoreText.setText("Puntos: "+this.SCORE),this.burbujas.countActive()===0&&this._mostrar_victoria()}_mostrar_victoria(){this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"¡Enhorabuena, has ganado!",{fontSize:"64px",color:"#00ffcc",fontFamily:"Impact"}).setOrigin(.5),this.physics.pause(),this.time.delayedCall(3e3,()=>{this.scene.get(_).return_to_dialogo()})}_game_over(){if(this.losing)return;this.losing=!0,this.physics.pause(),this.time.removeAllEvents();const t=this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2,"Vaya, parece que algo no ha cargado bien!",{fontSize:"96px",color:"#ff0000",fontFamily:"Impact"}).setOrigin(.5).setDepth(1);setTimeout(()=>{this.pantalla_final.enter(),t.destroy()},2e3)}_update(){this.started&&this.gota.y>this.SCREEN_HEIGHT&&this._reset_gota()}_reset_gota(){this.gota.setVelocity(0),this.gota.setPosition(this.barra.x,this.barra.y-120),this.gota.setData("onBarra",!0),this.gota.setVelocity(0,0)}_clean_up(){this.physics.pause(),this.gota&&this.gota.destroy(),this.barra&&this.barra.destroy(),this.mampara&&this.mampara.destroy(),this.burbujas.forEach(t=>t.destroy()),this.burbujas=[]}finnish_game(){this.pantalla_final.exit(),this._clean_up(),this.scene.get(_).return_to_dialogo()}}class jt extends g{constructor(t,e,s,i,a){super(t,e,s,"cafex"),this.setScale(i,a)}enter(){super.enter(),this.setGravityY(800),this.setBounce(0),this.setCollideWorldBounds(!0)}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class Gt extends g{constructor(t,e,s,i,a){super(t,e,s,"croasanx"),this.setScale(i,a)}enter(){super.enter(),this.setGravityY(800),this.setBounce(0),this.setCollideWorldBounds(!0)}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}}class Ct extends g{constructor(t,e,s,i,a,n){super(t,e,s,"fondoFruit"),this.setScale(a,n),this.body.setAllowGravity(!1)}enter(){super.enter()}exit(){super.exit()}_update(t,e){super._update(t,e)}_set_event(t){super._set_event(t)}_remove_event(t){super._remove_event(t)}_set_colliders(t=.8,e=.8){}}class Mt extends P{constructor(t,e,s,i){super(t,e,s,i)}}class Lt extends N{constructor(t,e,s,i){super(t,e,s,i)}}const wt="JuegoFruit";class Dt extends T{constructor(){super({key:wt});const t={CAFEX_IMG:"cafex",CROASANX_IMG:"croasanx",FONDO_IMG:"fondoFruit",PANTALLA_INICIO:"pantalla_inicio_fruit",PANTALLA_FINAL:"pantalla_final_fruit"};this.PLAYER_FRUIT_IMG=t.CAFEX_IMG,this.OBSTACLE_FRUIT_IMG=t.CROASANX_IMG,this.FONDO_IMG=t.FONDO_IMG,this.PANTALLA_INICIO_KEY=t.PANTALLA_INICIO,this.PANTALLA_FINAL_KEY=t.PANTALLA_FINAL,this.playerFruitWidth=100,this.playerFruitHeight=100,this.obstacleFruitWidth=100,this.obstacleFruitHeight=100,this.fondoWidth=1536,this.fondoHeight=1024,this.started=!1,this.losing=!1,this.gravityStarted=!1,this.jumpHandler=null,this.loseButton=null,this.mouseMoveHandler=null,this.initialPlayerYFactor=.2,this.deathLineYFactor=.2,this.horizontalMouseMoveActive=!0,this.deathLineY=0,this.deathLineGraphics=null,this.deathLinePadding=1,this.fallenPersonas=[],this.puntuacion=0,this.croasanxScaleFactor=.8}create(){this.puntuacion=0,this.losing=!1,this.gravityStarted=!1,this.horizontalMouseMoveActive=!0,this.SCREEN_WIDTH=this.sys.game.canvas.width,this.SCREEN_HEIGHT=this.sys.game.canvas.height,this.data_info_scene=this.scene.get(d),this.fallenPersonas=[],this._crear_fondo(),this._crear_marcador(),this._initial_player_and_deathline_setup(),this._crear_pantalla_inicio(),this._crear_pantalla_final(),this._crear_boton_perder(),this.cursors=this.input.keyboard.createCursorKeys(),this.jumpHandler=()=>{!this.gravityStarted&&this.cafe&&!this.losing&&(this.started||(!this.pantalla_inicio||this.pantalla_inicio&&!this.pantalla_inicio.visible)&&(this.started=!0),this.started&&(this.gravityStarted=!0,this.horizontalMouseMoveActive=!1,this.cafe.body&&this.cafe.body.setAllowGravity(!0)))},this.input.on("pointerdown",this.jumpHandler),this.mouseMoveHandler=t=>{this.horizontalMouseMoveActive&&this.cafe&&!this.losing&&(this.cafe.x=t.x,this.cafe.x=Phaser.Math.Clamp(this.cafe.x,this.cafe.displayWidth/2,this.SCREEN_WIDTH-this.cafe.displayWidth/2))},this.input.on("pointermove",this.mouseMoveHandler),this.game_created()}_crear_linea_muerte(){this.deathLineGraphics&&this.deathLineGraphics.destroy(),this.deathLineGraphics=this.add.graphics(),this.deathLineGraphics.lineStyle(4,16711680,1),this.deathLineGraphics.beginPath(),this.deathLineGraphics.moveTo(0,this.deathLineY),this.deathLineGraphics.lineTo(this.SCREEN_WIDTH,this.deathLineY),this.deathLineGraphics.closePath(),this.deathLineGraphics.strokePath(),this.deathLineGraphics.setDepth(150)}enter(){super.enter(),this._full_game_reset(),this.loseButton&&this.loseButton.setVisible(!0).setActive(!0),this.deathLineGraphics&&this.deathLineGraphics.setVisible(!0),this.pantalla_inicio&&typeof this.pantalla_inicio.enter=="function"?this.pantalla_inicio.enter():(console.warn("Pantalla de inicio no disponible para JuegoFruit"),this.start_game_logic())}start_game(){super.start_game(),this.started||this._full_game_reset(),this.pantalla_inicio&&typeof this.pantalla_inicio.exit=="function"&&this.pantalla_inicio.visible&&this.pantalla_inicio.exit(),this.start_game_logic()}start_game_logic(){this.fondo&&typeof this.fondo.enter=="function"&&this.fondo.enter(),this.started=!0,this.physics.resume(),this.loseButton&&this.loseButton.setVisible(!0).setActive(!0),this.deathLineGraphics&&this.deathLineGraphics.setVisible(!0)}_full_game_reset(){this.losing=!1,this.gravityStarted=!1,this.horizontalMouseMoveActive=!0,this.puntuacion=0,this.contadorTexto&&this.contadorTexto.setText(`Puntuación: ${this.puntuacion}`),this.timerEvent&&(this.timerEvent.remove(!1),this.timerEvent=null),this.fallenPersonas.forEach(t=>{t&&t.destroy&&t.destroy()}),this.fallenPersonas=[],this.cafe&&(this.cafe.destroy(),this.cafe=null),this._setup_new_cafex()}_setup_new_cafex(){const t=this.SCREEN_WIDTH/2,e=this.SCREEN_HEIGHT*this.initialPlayerYFactor,s=80,i=s/Math.max(this.playerFruitWidth,this.playerFruitHeight);this.cafe=new jt(this,t,e,i,i),this.cafe.setDepth(10),this.cafe.body?(this.cafe.setCollideWorldBounds(!0),this.cafe.body.setAllowGravity(!1),this.cafe.body.gravity.y=800,this.cafe.setVelocity(0,0),this.cafe.clearTint(),this.cafe.setAlpha(1),this.cafe.setActive(!0).setVisible(!0),this.cafe.body.setEnable(!0),this.fallenPersonas.forEach(a=>{a&&a.active&&a.body&&a.body.enable&&this.physics.add.collider(this.cafe,a,(n,o)=>{if(this.losing)return;const h=n.body.touching.down&&o.body.touching.up,c=this.gravityStarted;if(h&&c){if(n.objectType==="cafex"&&o.objectType==="cafex"){const u=o.x,m=o.y,E=s*this.croasanxScaleFactor/Math.max(this.obstacleFruitWidth,this.obstacleFruitHeight),x=new Gt(this,u,m,E,E);x.setDepth(o.depth),x.body&&(x.body.setImmovable(!0),x.body.setAllowGravity(!1),x.setCollideWorldBounds(!0),x.refreshBody());const k=this.fallenPersonas.indexOf(o);k>-1&&this.fallenPersonas.splice(k,1),o.destroy(),n.destroy(),this.cafe=null,this.fallenPersonas.push(x),this.puntuacion+=5,this.contadorTexto&&this.contadorTexto.setText(`Puntuación: ${this.puntuacion}`),this.gravityStarted=!1,this.horizontalMouseMoveActive=!0,this.timerEvent&&(this.timerEvent.remove(!1),this.timerEvent=null),this._setup_new_cafex();return}if(n.y-n.displayHeight/2<=this.deathLineY+this.deathLinePadding){const u=Math.abs(n.x-o.x)<(n.displayWidth/2+o.displayWidth/2)*.9,m=n.y<o.y;u&&m?this._game_over("apilado_demasiado_alto_directo"):this._handle_successful_landing()}else this.losing||this._handle_successful_landing()}},null,this)})):console.warn("New cafe body not immediately available during _setup_new_cafex. Colliders with fallen might be missed for this instance."),this.puntuacion+=10,this.contadorTexto&&this.contadorTexto.setText(`Puntuación: ${this.puntuacion}`)}_handle_successful_landing(){if(!(this.losing||!this.cafe||!this.cafe.body||!this.gravityStarted)){if(this.cafe&&this.cafe.body){if(this.cafe.body.setVelocity(0,0),this.cafe.body.setAllowGravity(!1),this.cafe.body.setImmovable(!0),this.cafe.y-this.cafe.displayHeight/2<=this.deathLineY+this.deathLinePadding){this.cafe.setTint(16711680),this._game_over("apilado_demasiado_alto_en_handle");return}this.cafe.setAlpha(1),this.cafe.setDepth(1)}this.fallenPersonas.push(this.cafe),this.gravityStarted=!1,this.horizontalMouseMoveActive=!0,this.timerEvent&&(this.timerEvent.remove(!1),this.timerEvent=null),this._setup_new_cafex()}}finnish_game(){this.pantalla_final&&typeof this.pantalla_final.exit=="function"&&this.pantalla_final.exit(),this._clean_up(),this.scene.get(_).return_to_dialogo()}_crear_marcador(){this.contadorTexto=this.add.text(this.SCREEN_WIDTH-50,50,`Puntuación: ${this.puntuacion}`,{fontSize:"40px",fill:"#ffffff",fontFamily:"Arial, sans-serif",stroke:"#000000",strokeThickness:3}).setOrigin(1,0).setDepth(100)}_crear_fondo(){let t=0,e=0,s=this.SCREEN_WIDTH/this.fondoWidth,i=this.SCREEN_HEIGHT/this.fondoHeight;this.fondo=new Ct(this,t,e,s,i),this.fondo.setOrigin(0,0)}_initial_player_and_deathline_setup(){this.deathLineY=this.SCREEN_HEIGHT*this.deathLineYFactor,this.deathLineY=Math.min(this.deathLineY,this.SCREEN_HEIGHT-4),this.deathLineY=Math.max(this.deathLineY,0),this._crear_linea_muerte()}_crear_pantalla_inicio(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_INICIO_KEY);s&&s.key?this.pantalla_inicio=new Mt(this,t,e,s):(console.warn(`[${this.sys.settings.key}] Imagen para pantalla de inicio con clave lógica '${this.PANTALLA_INICIO_KEY}' no encontrada.`),this.pantalla_inicio={enter:()=>{this.started||this.start_game_logic()},exit:()=>{},destroy:()=>{},visible:!1})}_crear_pantalla_final(){let t=0,e=0,s=this.data_info_scene.get_img(_,this.PANTALLA_FINAL_KEY);s&&s.key?this.pantalla_final=new Lt(this,t,e,s):(console.warn(`[${this.sys.settings.key}] Imagen para pantalla final con clave lógica '${this.PANTALLA_FINAL_KEY}' no encontrada.`),this.pantalla_final={enter:i=>this.finnish_game(),exit:()=>{},destroy:()=>{}})}_crear_boton_perder(){this.loseButton=this.add.text(50,50,"Abandonar Partida",{fontSize:"40px",fill:"#000000",backgroundColor:"#ff877e",padding:{x:10,y:7},fontFamily:"Arial, sans-serif"}).setOrigin(0,0).setDepth(200).setInteractive({useHandCursor:!0}),this.loseButton.on("pointerdown",e=>{e.event.stopPropagation(),this.started&&!this.losing&&this._game_over("boton")}),this.loseButton.setVisible(!1).setActive(!1)}_game_over(t="colision"){if(this.losing)return;this.losing=!0,this.horizontalMouseMoveActive=!1,this.loseButton&&this.loseButton.setVisible(!1).setActive(!1),this.deathLineGraphics&&this.deathLineGraphics.setVisible(!1);let e="¡FRUTA APLASTADA!";this.cafe&&this.cafe.body&&(this.cafe.setTint(16711680),this.cafe.body.setAllowGravity(!1),this.cafe.body.setVelocity(0,0)),this.physics.pause(),this.timerEvent&&(this.timerEvent.remove(!1),this.timerEvent=null),t==="boton"?e="Se terminó la partida":t==="colision_techo"?e="¡DEMASIADO ALTO!":t==="colision_jugador_caido"?e="¡COLISIÓN DE CAFÉS!":t.startsWith("apilado_demasiado_alto")&&(e="¡TORRE MUY ALTA!");const s=this.add.text(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2-50,e,{fontSize:"56px",fill:"#ff6347",fontFamily:"Arial Black, Gadget, sans-serif",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(200);this.time.delayedCall(2e3,()=>{s.destroy(),this.pantalla_final&&typeof this.pantalla_final.enter=="function"?this.pantalla_final.enter({score:this.puntuacion}):this.finnish_game()})}update(t,e){if(!(this.losing||!this.cafe||!this.cafe.body||!this.cafe.active)&&this.started&&this.gravityStarted&&this.cafe&&this.cafe.y+this.cafe.displayHeight/2>=this.SCREEN_HEIGHT){!this.losing&&this.fallenPersonas.length===0?this._handle_successful_landing():this.losing||this.cafe.body.onFloor()&&this._handle_successful_landing();return}}_clean_up(){super._clean_up&&super._clean_up(),this.jumpHandler&&(this.input.off("pointerdown",this.jumpHandler),this.jumpHandler=null),this.mouseMoveHandler&&(this.input.off("pointermove",this.mouseMoveHandler),this.mouseMoveHandler=null),this.timerEvent&&(this.timerEvent.remove(!1),this.timerEvent=null),this.time.removeAllEvents(),this.fallenPersonas&&(this.fallenPersonas.forEach(t=>{t&&typeof t.destroy=="function"&&t.destroy()}),this.fallenPersonas=[]),this.cafe&&typeof this.cafe.destroy=="function"&&(this.cafe.destroy(),this.cafe=null),this.fondo&&typeof this.fondo.destroy=="function"&&(this.fondo.destroy(),this.fondo=null),this.contadorTexto&&typeof this.contadorTexto.destroy=="function"&&(this.contadorTexto.destroy(),this.contadorTexto=null),this.loseButton&&typeof this.loseButton.destroy=="function"&&(this.loseButton.destroy(),this.loseButton=null),this.deathLineGraphics&&typeof this.deathLineGraphics.destroy=="function"&&(this.deathLineGraphics.destroy(),this.deathLineGraphics=null),this.pantalla_inicio&&typeof this.pantalla_inicio.destroy=="function"&&this.pantalla_inicio.destroy(),this.pantalla_final&&typeof this.pantalla_final.destroy=="function"&&this.pantalla_final.destroy(),this.pantalla_inicio=null,this.pantalla_final=null,this.started=!1,this.losing=!1,this.gravityStarted=!1,this.horizontalMouseMoveActive=!0,this.puntuacion=0}shutdown(){this._clean_up(),this.physics.world&&this.physics.pause()}}class Rt extends b{constructor(){super({key:_})}_reset_data(){this.current_minigame=null}create(){this.data_info_scene=this.scene.get(d),this.scene_created()}enter(t){super.enter(t)&&(this.scene_data=t,this.start_minigame(t.name))}return_to_dialogo(){console.log("Volviendo al diálogo desde el minijuego."),this.exit_minigame(),this.scene_data&&this.scene_data.return_dialogo?this.scene.get(f).signal_click({scene:"dialogo",name:this.scene_data.return_dialogo}):console.error("No se encontró el return_dialogo para volver al diálogo.")}exit(){super.exit()&&this.exit_minigame()}start_minigame(t){this.current_minigame&&this.current_minigame.scene.stop(),this.add_scene_minijuego(t,this.get_minijuego(t))}exit_minigame(){this.current_minigame&&(this.current_minigame.scene.stop(),this.current_minigame=null)}_update(){this.current_minigame&&this.current_minigame._update()}open_dialog(t){this.scene.get(v).enter(t)}game_created(){this.current_minigame.enter()}add_scene_minijuego(t,e){this.scene.get(t)&&this.scene.remove(t),this.scene.add(t,e,!1),this.scene.launch(t),this.current_minigame=this.scene.get(t)}get_minijuego(t){switch(t){case U:return gt;case z:return At;case W:return Nt;case et:return Dt;default:return null}}}class R extends L{constructor(t,e,s,i,a,n,o,h,c,l){super(t,e,s,i,a,n,c),this.game_object_data={alpha:this.alpha,scaleX:this.scaleX,scaleY:this.scaleY,pos_x:this.x,pos_y:this.y},this.delay=o,this.anitmation_info=h,h&&(this.animation=new O(t)),this.nombre=l}_reset_varaibles(){super._reset_varaibles(),this.nombre="",this.on_click=null,this.animation=null}finish_animation(){this.scene.finish_animation()}exit(){super.exit()}enter(){super.enter(),setTimeout(()=>{this._add_sprite(this.anitmation_info)},this.delay)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}_start_animation(){super._start_animation()}_stop_animation(){super._stop_animation()}_set_events(){super._set_events()}_remove_events(){super._remove_events()}_mouse_enter(){super._mouse_enter()}_mouse_over(){super._mouse_over()}_mouse_out(){super._mouse_out()}_mouse_down(){super._mouse_down()}_mouse_up(){super._mouse_up(),this.scene.signal_click(this.on_click)}_mouse_move(){super._mouse_move()}before_destroy(){super.before_destroy()}}class Ht extends R{constructor(t,e,s){const i=e.nombre,a=s[i],n={nombre:a.nombre,nombre_img:e.nombre_img??a.img,pose:e.pose??a.pose,x:e.pos_x??a.pos_x,y:e.pos_y??a.pos_y,size:e.size??a.size,delay:e.delay??a.delay,animation:e.hasOwnProperty("animation")?e.animation:a.animation,on_click:e.hasOwnProperty("on_click")?e.on_click:a.on_click};n.nombre_img=t.scene.get(d).get_img(y,n.nombre_img+"_"+n.pose),super(t,n.x,n.y,n.nombre_img,n.size,n.size,n.delay,n.animation,n.on_click,n.nombre)}}class kt extends R{constructor(t,e,s,i,a,n,o){super(t,e,s,i,a,a,0,null,n,o)}}class Ft extends R{constructor(t,e,s,i,a,n,o){super(t,e,s,i,a,a,0,null,n,o)}}class Bt{constructor(t,e){this.scene=t,this.extra_info=e,this.data_info_scene=this.scene.scene.get(d),this.data=this.data_info_scene.get_data_json(),this.data_json=this.data.Json;let s=this.data_info_scene.get_json(this.data_json.PantallaInfo);this.selected_pantalla_info=s[this.extra_info.pantalla.nombre]}cargar_fondo(){let t=this.data_info_scene.get_img(y,this.selected_pantalla_info.background),e=this.scene.add.image(0,0,t).setOrigin(0,0),s=this.scene.scale.width,i=this.scene.scale.height,a=e.width,n=e.height,o=i/n;return this.scale=o,this.displayWidth<s&&(this.scale=s/a,e.setScale(this.scale)),e.setScale(o),e}cargar_puertas(){return this.cargar_elementos("puertas",kt)}cargar_objetos(){return this.cargar_elementos("objetos",Ft)}cargar_elementos(t,e){let s=this.selected_pantalla_info[t]||{},i=this.extra_info.pantalla[t]||{},a=[];return Object.keys(s).forEach(n=>{let o=s[n],h=i[n]||{},c={...o,...h},{nombre:l,pos_x:p,pos_y:u,on_click:m}=c,H=this.data_info_scene.get_img(y,n),E=new e(this.scene,p*this.scale,u*this.scale,H,this.scale,m,l);a.push(E)}),a}}class Ut extends b{constructor(){super({key:y}),this.NOMBRE_MUSICA="tema_inicial",this.BACKGROUND_DEPTH=0,this.PUERTAS_DEPTH=1,this.OBJETOS_DEPTH=1,this.NPCS_DEPTH=2,this.PROTA_DEPTH=3,this._reset_variables(),this.interactuables_animations={},this.npcs_array=[],this.puertas=[],this.objetos=[]}_reset_variables(){this.offset_x=0,this.offset_y=0,this.can_move=!1,this.animation_finished=!1,this.total_animations=0,this.animations_finished=0,this.move_limit_x=0,this.move_limit_y=0}create(){this.data_info_scene=this.scene.get(d),this.data=this.data_info_scene.get_data_json(),this.data_json=this.data.Json,this.pantallas_data=this.data_info_scene.get_json(this.data_json.Pantallas),this.personajes_data=this.data_info_scene.get_json(this.data_json.PersonajesInfo),this.scene_created()}move(t,e){if(!this.animation_finished)return;let s=this.offset_x+t,i=this.offset_y+e;s=Phaser.Math.Clamp(s,-this.move_limit_x,this.move_limit_x),i=Phaser.Math.Clamp(i,-this.move_limit_y,this.move_limit_y);const a=s-this.offset_x,n=i-this.offset_y;this.offset_x=s,this.offset_y=i,a!==0&&(this.background&&(this.background.x+=a),this.prota&&(this.prota.x+=a),this.npcs_array.forEach(o=>o.x+=a),this.puertas&&this.puertas.forEach(o=>o.x+=a),this.objetos&&this.objetos.forEach(o=>o.x+=a)),n!==0&&(this.background&&(this.background.y+=n),this.prota&&(this.prota.y+=n),this.npcs_array.forEach(o=>o.y+=n),this.puertas&&this.puertas.forEach(o=>o.y+=n),this.objetos&&this.objetos.forEach(o=>o.y+=n))}_load_pantalla(t){this.pantalla_data=this.pantallas_data[t],this.creador_pantalla=new Bt(this,this.pantalla_data),this.sys.game.canvas,this._load_background(),this._load_npcs(),this._load_prota(),this._load_puertas(),this._load_objetos()}exit(){super.exit(),this.prota&&this.prota.exit(),this.background&&this.background.destroy(),this.npcs_array.forEach(t=>{t.exit()}),this.puertas.forEach(t=>{t.exit()}),this.objetos.forEach(t=>{t.exit()})}enter(t){let e=null;t.name?e=t.name:e=t,super.enter(e)&&(this.play_music(this.NOMBRE_MUSICA),this._reset_variables(),this._load_pantalla(e),this.background.displayWidth>this.sys.game.canvas.width?(this.move_limit_x=(this.background.displayWidth-this.sys.game.canvas.width)/2,this.move_limit_y=(this.background.displayHeight-this.sys.game.canvas.height)/2,this.animation_finished=!0,this.move(-this.move_limit_x,-this.move_limit_y)):(this.move_limit_x=(this.background.displayWidth-this.sys.game.canvas.width)/2,this.move_limit_y=(this.background.displayHeight-this.sys.game.canvas.height)/2,this.animation_finished=!0,this.move(-this.move_limit_x,-this.move_limit_y)),this.animation_finished=!1,this.offset_x=0,this.offset_y=0,this.pause())}_update(t,e){super._update()}pause(){super.pause(),this.prota&&this.prota.pause(),this.npcs_array.forEach(t=>{t.pause()})}unpause(){super.unpause(),this.prota&&this.prota.unpause(),this.npcs_array.forEach(t=>{t.unpause()}),this.puertas.forEach(t=>{t.unpause()}),this.objetos.forEach(t=>{t.unpause()})}starting_animation(){this.pause()}finish_animation(){this.animations_finished++,this.animations_finished==this.total_animations&&(this.animation_finished=!0,this.unpause())}signal_click(t){t.scene=="pantalla"?(this.exit(),this.enter(t.name)):this.scene.get(f).signal_click(t)}_load_background(){this.background=this.creador_pantalla.cargar_fondo(),this.background.setDepth(this.BACKGROUND_DEPTH),this.background.setSize(1.2,1.2)}_load_npcs(){if(this.npcs_array.length>0&&this.npcs_array.forEach(e=>{e.destroy()}),this.npcs_array=[],!this.pantalla_data.npcs)return;let t=this.pantalla_data.npcs;Object.keys(t).forEach(e=>{this.npcs_array.push(this._load_personaje(t[e])),this.npcs_array[this.npcs_array.length-1].setDepth(this.NPCS_DEPTH),this.npcs_array[this.npcs_array.length-1].enter()})}_load_prota(){this.pantalla_data.prota!=null&&(this.prota=this._load_personaje(this.pantalla_data.prota),this.prota.setDepth(this.PROTA_DEPTH),this.prota.enter())}_load_personaje(t){return this.total_animations++,new Ht(this,t,this.personajes_data)}_load_puertas(){this.puertas&&this.puertas.forEach(t=>{t.destroy()}),this.puertas=this.creador_pantalla.cargar_puertas(this.scale),this.puertas.forEach(t=>{t.setDepth(this.PUERTAS_DEPTH),t.enter(),this.total_animations++})}_load_objetos(){this.objetos&&this.objetos.forEach(t=>{t.destroy()}),this.objetos=this.creador_pantalla.cargar_objetos(),this.objetos.forEach(t=>{t.setDepth(this.OBJETOS_DEPTH),t.enter(),this.total_animations++})}}class zt extends b{constructor(){super({key:G}),this.VARIABLE_DIALOGO="variables_dialogo"}_reset_data(){}create(){this.data_info_scene=this.scene.get(d),this.variables_data=this.data_info_scene.get_json(this.VARIABLE_DIALOGO),this.datos_actualizados=!1}_load_dialogo(t){}exit(){this.datos_actualizados&&this.data_info_scene.guardar_progreso(this.datos_usuario),super.exit()}enter(t){console.log("Entrando en el manager de dialogo de afinidad"),this.datos_actualizados=!1,this.datos_usuario=this.data_info_scene.get_datos_usaurio(),this.variable_data=this.variables_data[t.var_id],this.next_scene_id=t.name,this._get_length()==1?this.actualizar_datos():this.elegir_dialogo()}_get_length(){let t=Object.keys(this.variable_data).length/2,e=0;for(let s=1;s<=t;s++)this.variable_data["var_"+s]&&e++;return e}elegir_dialogo(){let t="val_",e="var_",s=this._get_length(),i=this.datos_usuario.Afinidad;for(let a=1;a<=s;a++){let n=this.variable_data[e+a],o=this.variable_data[t+a];if(!i[n]){this.inicializar_datos(n);continue}if(i[n]>=o){this.enviar_dialogo(a);return}}console.error("No se ha encontrado un dialogo para la variable: "+this.variable_data.name),this.enviar_dialogo(1)}actualizar_datos(){typeof this.variable_data.val_1=="boolean"?this.datos_usuario.Afinidad[this.variable_data.var_1]=this.variable_data.val_1:this.datos_usuario.Afinidad[this.variable_data.var_1]+=this.variable_data.val_1,this.datos_actualizados=!0,this.enviar_dialogo(-1)}inicializar_datos(t){this.datos_usuario.Afinidad[t]=0,t=="afinidad_maria"&&(this.datos_usuario.Afinidad[t]=40),this.datos_actualizados=!0}get_npc_most_afinity(){let t=Object.keys(this.variable_data).length/2,e=0,s=null;for(let i=1;i<=t;i++){let a=this.variable_data["var_"+i];this.variable_data["val_"+i],(typeof this.datos_usuario.Afinidad[a]=="boolean"&&this.datos_usuario.Afinidad[a]||this.datos_usuario.Afinidad[a]>e)&&(e=this.datos_usuario.Afinidad[a],s=a)}return s}enviar_dialogo(t){let e={scene:"dialogo",name:this.next_scene_id+this._numero_a_letra(t),var_id:null};this.scene.get(f).signal_click(e)}_numero_a_letra(t){return t==-1?"":String.fromCharCode(64+t)}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}}const Wt={apiKey:"AIzaSyCL31kN-RfrF8CiPhiPnxZmGmfYVUI3tV4",authDomain:"bitbybit-43aee.firebaseapp.com",projectId:"bitbybit-43aee",storageBucket:"bitbybit-43aee.firebasestorage.app",messagingSenderId:"494311902150",appId:"1:494311902150:web:0e6b80bc1889ca702dc0c7"},J=q(Wt),Vt=F(J),j=Z(J),Yt=new $;async function Jt(){try{return(await K(Vt,Yt)).user}catch(r){return console.error("❌ Error al iniciar sesión:",r),null}}async function C(r,t){try{await B(S(j,"progresos",r),{...t,actualizado:Q()})}catch(e){console.error("❌ Error al guardar:",e)}}async function X(r){try{const t=S(j,"progresos",r),e=await M(t);return e.exists()?e.data():(console.log("⚠️ No hay progreso guardado aún."),null)}catch(t){return console.error("❌ Error al cargar:",t),null}}async function Xt(r,t){const e=S(j,"rankings","record_minijuegos");try{(await M(e)).exists()?await tt(e,{[r]:t}):await B(e,{Minijuegos:{[r]:t}})}catch(s){console.error("❌ Error al guardar ranking:",s)}}async function $t(){try{const r=S(j,"rankings","record_minijuegos"),t=await M(r);return t.exists()?t.data()||null:(console.log("⚠️ No hay ranking guardado aún."),null)}catch(r){return console.error("❌ Error al cargar ranking:",r),null}}class Kt extends Phaser.Scene{constructor(){super(I)}async create(){const t=this.cameras.main.centerX,e=this.cameras.main.centerY;this.texto1=this.add.text(t,e-100,"Inicia sesión con Google",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.loginButton=this.add.rectangle(t,e,300,60,4359668).setInteractive({useHandCursor:!0}).on("pointerdown",async()=>this.iniciarSesion()),this.texto2=this.add.text(t,e,"Google Login",{fontSize:"24px",color:"#ffffff"}).setOrigin(.5),F().onAuthStateChanged(async s=>{s&&await this.cargarProgresoYEntrar(s)}),this.events.once(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}async iniciarSesion(){const t=await Jt();t?await this.cargarProgresoYEntrar(t):this.mostrarError("Inicio de sesión cancelado o fallido")}async cargarProgresoYEntrar(t){const e=t.uid;let s=await X(e);s||(s=this.scene.get(d).get_saves(),await C(e,s)),this.scene.get(f).agregar_scenes({userId:e,displayName:t.displayName,progreso:s})}mostrarError(t){const e=this.cameras.main.centerX;this.texto3=this.add.text(e,500,t,{fontSize:"20px",color:"#ff5555"}).setOrigin(.5)}shutdown(){this.texto1.destroy(),this.texto2.destroy(),this.texto3&&this.texto3.destroy(),this.loginButton.removeAllListeners("pointerdown"),this.loginButton.destroy()}}class qt{constructor(t){this.scene=t,this.currentMusic=null,this.musicVolume=.1,this.sfxVolume=.3,this.activesfx=[],this.data_info_scene=t.scene.get(d)}play_music(t,e={}){const s=this.data_info_scene.get_musica(t);if(this.currentMusic&&this.currentMusic.key===s&&this.currentMusic.isPlaying)return;this.currentMusic&&this.currentMusic.stop();const i={loop:!0,volume:this.musicVolume,...e};this.currentMusic=this.scene.sound.add(s,i),this.currentMusic.play()}stop_music(){this.currentMusic&&(this.currentMusic.stop(),this.currentMusic=null)}set_music_volume(t){this.musicVolume=Phaser.Math.Clamp(t,0,1),this.currentMusic&&this.currentMusic.setVolume(this.musicVolume)}play_sfx(t,e={}){const s={volume:this.sfxVolume,...e},i=this.scene.sound.add(this.data_info_scene.get_musica(t),s);return i.play(),this.activesfx.push(i),i.once("complete",()=>{this.activesfx=this.activesfx.filter(a=>a!==i),i.destroy()}),i}stop_all_sfx(){this.activesfx.forEach(t=>{t.stop(),t.destroy()}),this.activesfx=[]}set_sfx_volume(t){this.sfxVolume=Phaser.Math.Clamp(t,0,1),this.activesfx.forEach(e=>{e.setVolume(this.sfxVolume)})}}class Zt extends b{constructor(){super({key:f}),this.scenes={},this.currentScene=null,this.currentSceneData=null,this.cursor_data={edge_margin:200,move_speed:1}}create(){this.audio_manager=new qt(this),this.data_info_scene=this.scene.get(d),this.data=this.data_info_scene.get_data_json(),this.data_json=this.data.Json,this.scene.add(I,Kt,!1),this.scene.launch(I)}agregar_scenes(t){this.scene.stop(I),this.data_info_scene.save_firestore_data(t),this.saves_data=this.data_info_scene.get_json(this.data_json.Saves),this.events.on(V,this.scene_created,this),this.add_scene(y,Ut,this.saves_data.Pantalla),this.add_scene(v,ot,this.saves_data.Dialogo),this.add_scene(_,Rt),this.add_scene(G,zt),this.add_scene(A,ht),this.cursor=this.scenes[A],this.cursor.enter(this.cursor_data)}add_scene(t,e,s=null){this.scene.get(t)&&this.scene.remove(t),this.scene.add(t,e,!1),this.scene.launch(t),this.scenes[t]=this.scene.get(t),s&&(this.currentScene=t,this.currentSceneData=s)}signal_click(t){this.scenes[this.currentScene].exit(),this.currentScene=this._get_next_scene(t.scene),t.scene==="minijuego"?this.scenes[this.currentScene].enter(t):this.scenes[this.currentScene].enter(t.name)}scene_created(t){t==this.currentScene?this.scenes[t].enter(this.currentSceneData):this.scenes[t].exit()}_get_next_scene(t){switch(t){case"dialogo":return v;case"pantalla":return y;case"minijuego":return _;case"afinidad_dialogo":return G}}cursor_entered(t,e){this.cursor.cursor_entered(t,e)}cursor_exited(t){this.cursor.cursor_exited(t)}move(t,e){this.scenes[this.currentScene].move(t,e)}exit(){this.pause()}enter(t){this.unpause()}update(t,e){this.currentScene&&(this.scenes[this.currentScene]._update(t,e),this.cursor._update(t,e))}_update(){super.update()}pause(){super.pause()}unpause(){super.unpause()}play_music(t,e,s={}){t==this.currentScene&&this.audio_manager.play_music(e,s)}stop_music(t){t==this.currentScene&&this.audio_manager.stop_music()}set_music_volume(t,e){t==this.currentScene&&this.audio_manager.set_music_volume(e)}play_sfx(t,e,s={}){t==this.currentScene&&this.audio_manager.play_sfx(e,s)}stop_all_sfx(t){t==this.currentScene&&this.audio_manager.stop_all_sfx()}set_sfx_volume(t,e){t==this.currentScene&&this.audio_manager.set_sfx_volume(e)}}class Qt extends Phaser.Scene{constructor(){super({key:d,active:!0}),this.ROOT="/DVI/",this.ASSETS_PATH=this.ROOT+"assets/",this.JSON_PATH=this.ASSETS_PATH+"json/",this.IMG_PATH=this.ASSETS_PATH+"img/",this.json_data="json_data",this.data_name="data.json",this.asdasd=0}preload(){this.load.json(this.json_data,this.JSON_PATH+this.data_name)}create(){this.data=this.cache.json.get(this.json_data).Assets,this.data_json=this.data.Json,this.data_imgs=this.data.Imgs,this.data_musica=this.data.Musica,this.ROOT=this.data.Root,this.ASSETS_PATH=this.ROOT+this.data.Path,this.JSON_PATH=this.ASSETS_PATH+this.data_json.Path,this.IMG_PATH=this.ASSETS_PATH+this.data_imgs.Path,this.MUSICA_PATH=this.ASSETS_PATH+this.data_musica.Path,this.json_prefix=this.data_json.Prefix,this.img_prefix=this.data_imgs.Prefix,this.musica_prefix=this.data_musica.Prefix;let t=this.data_json.Folders;this.load.on("filecomplete",()=>{this.loaded||(this.loaded=!0,this.crear_laoding_screen(),this.get_number_assets(),this.load_assets())}),this.load.json(this.json_prefix+t,this.JSON_PATH+t+this.data_json.Suffix),this.load.start()}crear_laoding_screen(){const{width:t,height:e}=this.scale;this.loading_box=this.add.graphics(),this.loading_box.fillStyle(2236962,.8),this.loading_box.fillRect(t/2-t/4,e/2-20,t/2,200),this.loading_bar=this.add.graphics(),this.bar_x=t/2-t/4+10,this.bar_y=e/2-10,this.bar_width=t/2-20,this.bar_height=180}get_number_assets(){const t=this.cache.json.get(this.json_prefix+this.data_json.Folders);this.number_assets=this.get_number_assets_recursive(t),this.loaded_assets=0}get_number_assets_recursive(t){let e=0;return t.folders.forEach(s=>{e+=this.get_number_assets_recursive(s)}),e+=t.files.length,e}update_loading_bar(t){this.loading_bar.clear(),this.loading_bar.fillStyle(16777215,1),this.loading_bar.fillRect(this.bar_x,this.bar_y,this.bar_width*t,this.bar_height)}load_assets(){this.load.on("progress",t=>{this.update_loading_bar(t)}),this.load.on("complete",()=>{setTimeout(()=>{this.scene.start(f)},100)}),this.load_jsons(),this.load_imgs(),this.load_musicas(),this.load.start()}load_jsons(){this.data_json.Jsons.forEach(e=>{this.load_json(e)})}load_json(t){const e=this.data_json.Suffix;this.load.json(this.json_prefix+t,this.JSON_PATH+t+e)}get_data_json(){return this.cache.json.get(this.json_data).Assets}get_saves(){return this.cache.json.get(this.json_prefix+"saves")}get_json(t){let e=t.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join("");return this.cache.json.get(this.json_prefix+t)[e]}load_imgs(){this.data_imgs.Clases.forEach(e=>{this.data_imgs[e].Clases.forEach(i=>{this.data_imgs[e][i][i].forEach(n=>{this.laod_img(e,i,n)})})})}laod_img(t,e,s){let i="";switch(e){case"Backgrounds":i=this.data_imgs[t].Path+this.data_imgs[t][e].Path+s+"/",this.load_img2(t,s,i);break;case"Personajes":this.data_imgs[t][e].Poses.forEach(o=>{i=this.data_imgs[t].Path+this.data_imgs[t][e].Path+s+"/",this.load_img2(t,s+"_"+o,i)});break;case"JuegoOveja":case"JuegoDiscoteca":case"JuegoDucha":case"JuegoFruit":case"Dialogos":case"Cursors":i=this.data_imgs[t].Path+this.data_imgs[t][e].Path,this.load_img2(t,s,i);break;case"Puertas":this.data_imgs[t][e].Lados.forEach(o=>{i=this.data_imgs[t].Path+this.data_imgs[t][e].Path+s+"/",this.load_img2(t,s+"_"+o,i)});break;case"Objetos":i=this.data_imgs[t].Path+this.data_imgs[t][e].Path,this.load_img2(t,s,i);break;default:console.log("Clase no encontrada",t,e,s);break}}load_img2(t,e,s){const i=this.data_imgs.Suffix;this.load.image(this.img_prefix+t+"_"+e,this.IMG_PATH+s+e+i),console.info(this.img_prefix+t+"_"+e,this.IMG_PATH+s+e+i)}load_musicas(){this.data_musica.Musicas.forEach(e=>{this.load_musica(e)})}load_musica(t){const e=this.data_musica.Suffix;this.load.audio(this.musica_prefix+t,this.MUSICA_PATH+t+e)}get_musica(t){return this.musica_prefix+t}get_img(t,e){let s="";switch(t){case y:case"Pantallas":s="Pantallas";break;case v:case"Dialogos":s="Dialogos";break;case _:case"Minijuegos":s="Minijuegos";break;case A:case"Cursors":s="Cursors";break}return this.img_prefix+s+"_"+e}save_firestore_data(t){this.userId=t.userId,this.userName=t.displayName,this.progreso=t.progreso,this.cargar_datos_usuario(),this.cargar_rankings()}guardar_progreso(t){if(!this.userId){console.error("⚠️ No hay sesión activa.");return}this.progresos={Save:{progreso:t}},C(this.userId,this.progreso)}guardar_puntuacion(t,e){if(!this.userId||!this.progreso){console.error("⚠️ No hay sesión activa o progreso cargado.");return}if(this.progreso.Saves||(this.progreso.Saves={}),this.progreso.Saves.Minijuegos||(this.progreso.Saves.Minijuegos={}),!this.progreso.Saves.Minijuegos[t]){this.progreso.Saves.Minijuegos[t]={RecortdPuntuacion:e};return}const s=this.progreso.Saves.Minijuegos[t].RecortdPuntuacion;e<=s||(this.progreso.Saves.Minijuegos[t].RecortdPuntuacion=e,C(this.userId,this.progreso),this.actualizar_ranking(t,e))}cargar_datos_usuario(){if(!this.userId){console.error("⚠️ No hay sesión activa.");return}X(this.userId).then(t=>{t?this.progreso=t:console.error("⚠️ No se encontraron datos para el usuario.")}).catch(t=>{console.error("❌ Error al cargar datos:",t)})}cargar_rankings(){if(!this.userId){console.error("⚠️ No hay sesión activa.");return}$t().then(t=>{t?(this.ranking=t,this.ranking):console.error("⚠️ No se encontraron rankings para el usuario.")}).catch(t=>{console.error("❌ Error al cargar rankings:",t)})}get_datos_usaurio(){return console.log("asdas:2",this.progreso),this.progreso.Saves}get_ranking(t){return this.ranking[t]||null}async actualizar_ranking(t,e){if(!this.userId||!this.ranking){console.error("⚠️ No hay sesión activa o ranking cargado.");return}this.ranking[t]||(console.log("⚠️ No existía ranking para",t),this.ranking[t]=[]);let s=this.ranking[t];s=s.filter(o=>o.Nombre!==this.userName),s.push({Nombre:this.userName,Puntuacion:e}),s.sort((o,h)=>h.Puntuacion-o.Puntuacion);const i=s.slice(0,10),a=JSON.stringify(this.ranking[t]),n=JSON.stringify(i);a!==n&&(this.ranking[t]=i,await Xt(t,i))}}const te={width:1820,height:1358,parent:"juego",physics:{default:"arcade",arcade:{gravity:{y:600},debug:!1}},scene:[Qt,Zt],scale:{mode:Phaser.Scale.EXACT_FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(te);
